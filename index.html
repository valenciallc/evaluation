<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Evaluation Form - Valencia Marble & Natural Stone Company</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== RESET & BASE ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #8b7355;
            --primary-dark: #6d5a42;
            --secondary-color: #2c3e50;
            --secondary-light: #3a506b;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --gray-color: #6c757d;
            --gray-light: #e9ecef;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --telegram-color: #0088cc;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* ========== LANGUAGE SWITCHER ========== */
        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .lang-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .lang-btn i {
            font-size: 1rem;
        }

        /* ========== HEADER ========== */
        .main-header {
            background: linear-gradient(to right, var(--primary-dark), var(--secondary-color));
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }

        .main-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.05)"/></svg>');
            background-size: cover;
        }

        .main-header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            position: relative;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }

        .company-name {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
        }

        /* ========== COMPANY LOGO ========== */
        .company-logo-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
        }

        .company-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.3);
            transition: var(--transition);
        }

        .company-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .company-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 10px;
        }

        .logo-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }

        .logo-upload-btn {
            position: absolute;
            bottom: -10px;
            right: -10px;
            background: var(--telegram-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid white;
            font-size: 0.8rem;
            transition: var(--transition);
            z-index: 11;
        }

        .logo-upload-btn:hover {
            background: #0077b5;
            transform: scale(1.1);
        }

        /* ========== LOGO UPLOAD MODAL ========== */
        .logo-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .logo-modal.show {
            display: flex;
        }

        .logo-modal-content {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo-modal-title {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-upload-area {
            border: 3px dashed var(--gray-light);
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: var(--transition);
        }

        .logo-upload-area:hover {
            border-color: var(--primary-color);
            background: var(--light-color);
        }

        .logo-upload-area i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .logo-preview-container {
            margin: 20px 0;
            text-align: center;
        }

        .logo-preview {
            width: 150px;
            height: 150px;
            margin: 0 auto 15px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid var(--gray-light);
            background: white;
        }

        .logo-preview img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 10px;
        }

        .logo-modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .logo-modal-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .logo-modal-btn.primary {
            background: var(--primary-color);
            color: white;
        }

        .logo-modal-btn.primary:hover {
            background: var(--primary-dark);
        }

        .logo-modal-btn.secondary {
            background: var(--gray-light);
            color: var(--dark-color);
        }

        .logo-modal-btn.secondary:hover {
            background: #d1d9e0;
        }

        /* ========== INSTRUCTIONS ========== */
        .instructions-container {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
            border-right: 5px solid var(--primary-color);
        }

        .instructions-title {
            color: var(--secondary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .instructions-title i {
            color: var(--primary-color);
        }

        .instructions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .instruction-item {
            background: var(--light-color);
            padding: 12px 15px;
            border-radius: 6px;
            border-right: 3px solid var(--primary-color);
        }

        .instruction-item strong {
            color: var(--secondary-color);
            display: block;
            margin-bottom: 5px;
        }

        .rating-scale {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .rating-item {
            text-align: center;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            min-width: 100px;
            margin: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .rating-value {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .rating-label {
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        /* ========== CONTROLS ========== */
        .controls-container {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
        }

        .controls-title {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-label i {
            color: var(--primary-color);
        }

        select, input, textarea {
            padding: 12px 15px;
            border: 2px solid var(--gray-light);
            border-radius: 6px;
            font-size: 1rem;
            transition: var(--transition);
            background: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(139, 115, 85, 0.2);
        }

        .btn-generate {
            background: linear-gradient(to right, var(--telegram-color), #1e96c8);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px auto 0;
            width: 100%;
            max-width: 350px;
            box-shadow: 0 4px 15px rgba(0, 136, 204, 0.3);
        }

        .btn-generate:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 136, 204, 0.4);
        }

        .btn-generate:active {
            transform: translateY(-1px);
        }

        .btn-generate i {
            font-size: 1.2rem;
        }

        /* ========== CALCULATOR ========== */
        .calculator-container {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
            border-right: 5px solid var(--success-color);
        }

        .calculator-title {
            color: var(--secondary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .calculator-formula {
            font-family: 'Courier New', monospace;
            background: var(--light-color);
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-size: 1.2rem;
            color: var(--success-color);
            text-align: center;
            border: 1px dashed var(--success-color);
        }

        .calculator-example {
            background: #f0f9ff;
            padding: 12px 15px;
            border-radius: 6px;
            margin-top: 10px;
            color: var(--secondary-color);
        }

        /* ========== NOTES SECTIONS ========== */
        .notes-section {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
            border-right: 5px solid var(--warning-color);
        }

        .notes-title {
            color: var(--secondary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .notes-title i {
            color: var(--warning-color);
        }

        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .note-group {
            display: flex;
            flex-direction: column;
        }

        .note-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .note-label i {
            color: var(--primary-color);
        }

        .notes-summary {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
            border-right: 5px solid var(--telegram-color);
        }

        .notes-summary-title {
            color: var(--secondary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .notes-summary-title i {
            color: var(--telegram-color);
        }

        /* ========== SECTIONS ========== */
        .sections-container {
            margin-bottom: 30px;
        }

        .section-card {
            background: white;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(to right, var(--light-color), #e9f2fa);
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-title {
            font-size: 1.3rem;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-points {
            background: var(--primary-color);
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 3px 10px rgba(139, 115, 85, 0.3);
        }

        .section-content {
            padding: 0;
        }

        /* ========== CRITERIA TABLE ========== */
        .criteria-table {
            width: 100%;
            border-collapse: collapse;
        }

        .criteria-table th {
            background: var(--light-color);
            padding: 15px;
            text-align: right;
            font-weight: 600;
            color: var(--secondary-color);
            border-bottom: 2px solid var(--gray-light);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .criteria-table td {
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
            vertical-align: middle;
        }

        .criteria-table tr:hover {
            background: #f9f9f9;
        }

        .criteria-name {
            font-weight: 600;
            color: var(--secondary-color);
        }

        .criteria-description {
            color: var(--gray-color);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .weight-badge {
            background: #e3f2fd;
            color: var(--secondary-color);
            padding: 8px 15px;
            border-radius: 6px;
            font-weight: 600;
            display: inline-block;
            min-width: 50px;
            text-align: center;
        }

        .rating-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .rating-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid var(--gray-light);
            background: white;
            font-weight: 600;
            font-size: 1rem;
            transition: var(--transition);
            user-select: none;
        }

        .rating-btn:hover {
            transform: scale(1.1);
            border-color: var(--primary-color);
        }

        .rating-btn.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 3px 8px rgba(139, 115, 85, 0.3);
        }

        .calculated-value {
            background: #e8f5e9;
            color: var(--success-color);
            padding: 10px 15px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 1.1rem;
            display: inline-block;
            min-width: 70px;
            text-align: center;
        }

        /* ========== SUMMARY ========== */
        .summary-container {
            background: linear-gradient(to right, var(--secondary-color), var(--primary-dark));
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
        }

        .summary-title {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            text-align: center;
        }

        .summary-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .summary-label {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .summary-subtext {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* ========== TOTAL SCORE ========== */
        .total-score-container {
            background: linear-gradient(to right, var(--success-color), #2ecc71);
            color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            text-align: center;
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
        }

        .total-score-label {
            font-size: 1.2rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .total-score-value {
            font-size: 3rem;
            font-weight: 800;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .total-score-grade {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 10px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            display: inline-block;
        }

        /* ========== FOOTER ========== */
        .main-footer {
            text-align: center;
            padding: 20px;
            color: var(--gray-color);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-light);
            margin-top: 30px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .footer-link {
            color: var(--primary-color);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        /* ========== PRINT STYLES ========== */
        @media print {
            @page {
                size: A4 landscape !important;  /* تغيير إلى الوضع الأفقي لاستيعاب محتوى أكثر */
                margin: 10mm !important;  /* تقليل الهوامش */
            }

            body {
                background: white !important;
                color: black !important;
                font-family: 'Times New Roman', serif !important;
                font-size: 8pt !important;  /* تقليل حجم الخط */
                line-height: 1.1 !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                height: 100% !important;
            }

            .container {
                max-width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                transform: scale(0.95) !important;
                transform-origin: top center !important;
            }

            /* إخفاء كل ما لا يريد طباعته */
            .main-header,
            .instructions-container,
            .controls-container,
            .calculator-container,
            .btn-generate,
            .main-footer,
            .notification,
            .rating-controls,
            .rating-btn,
            .section-header,
            .section-points,
            .header-icons,
            .language-switcher,
            .notes-section {
                display: none !important;
            }

            /* ========== PRINT REPORT HEADER ========== */
            .print-report-header {
                display: block !important;
                text-align: center;
                margin-bottom: 10px !important;
                padding-bottom: 8px !important;
                border-bottom: 2px solid #000;
                page-break-after: avoid;
            }

            .print-report-header h1 {
                font-size: 16pt !important;
                color: #000;
                margin-bottom: 5px !important;
                font-weight: bold;
            }

            .print-report-header .company-name {
                font-size: 10pt !important;
                color: #333;
                margin-bottom: 10px !important;
            }

            .print-info-table {
                width: 100% !important;
                border-collapse: collapse;
                margin: 8px 0 !important;
                font-size: 8pt !important;
                page-break-inside: avoid;
            }

            .print-info-table td {
                padding: 4px 6px !important;
                border: 1px solid #000;
                text-align: center;
            }

            .print-info-table th {
                padding: 4px 6px !important;
                border: 1px solid #000;
                background-color: #f0f0f0;
                font-weight: bold;
                text-align: center;
            }

            /* ========== COMPANY LOGO IN PRINT ========== */
            .company-logo-container {
                display: block !important;
                position: absolute;
                top: 10px;
                left: 10px;
            }

            .company-logo {
                width: 60px;
                height: 60px;
                border-radius: 50%;
                background: white !important;
                border: 2px solid #000 !important;
                box-shadow: none !important;
            }

            .company-logo img {
                padding: 5px !important;
            }

            .logo-upload-btn {
                display: none !important;
            }

            /* ========== COMPACT LAYOUT FOR PRINT ========== */
            .sections-container,
            .summary-container,
            .total-score-container,
            .notes-summary {
                display: block !important;
                page-break-inside: avoid !important;
                margin: 5mm 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                border-radius: 0 !important;
                background: white !important;
                color: black !important;
                page-break-before: avoid !important;
                page-break-after: avoid !important;
            }

            /* ========== COMPACT SECTION CARDS ========== */
            .section-card {
                margin: 0 0 8px 0 !important;
                border: 1px solid #000 !important;
                border-radius: 0 !important;
                box-shadow: none !important;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                max-height: none !important;
            }

            .section-title {
                color: #000 !important;
                font-size: 10pt !important;
                font-weight: bold !important;
                padding: 5px 6px !important;
                border-bottom: 1px solid #000 !important;
                background-color: #f0f0f0 !important;
                margin: 0 !important;
                page-break-after: avoid !important;
            }

            /* ========== COMPACT CRITERIA TABLES ========== */
            .criteria-table {
                width: 100% !important;
                border: 1px solid #000 !important;
                font-size: 7pt !important;
                page-break-inside: auto !important;
                border-collapse: collapse !important;
                margin: 0 !important;
            }

            .criteria-table th {
                background: #f0f0f0 !important;
                color: #000 !important;
                border: 1px solid #000 !important;
                padding: 3px 4px !important;
                font-weight: bold !important;
                text-align: center !important;
                font-size: 7pt !important;
                height: auto !important;
            }

            .criteria-table td {
                border: 1px solid #666 !important;
                padding: 3px 4px !important;
                font-size: 7pt !important;
                text-align: center !important;
                vertical-align: middle !important;
                height: auto !important;
                line-height: 1 !important;
            }

            .criteria-name {
                color: #000 !important;
                font-weight: bold !important;
                text-align: right !important;
                font-size: 7pt !important;
            }

            .criteria-description {
                color: #666 !important;
                font-size: 6pt !important;
                text-align: right !important;
                display: none !important;  /* إخفاء الوصف لتقليل المساحة */
            }

            .weight-badge {
                background: #f8f8f8 !important;
                color: #000 !important;
                border: 1px solid #666 !important;
                padding: 1px 3px !important;
                border-radius: 1px !important;
                font-weight: bold !important;
                display: inline-block !important;
                min-width: 20px !important;
                font-size: 7pt !important;
            }

            .calculated-value {
                background: #f8f8f8 !important;
                color: #000 !important;
                border: 1px solid #666 !important;
                padding: 1px 3px !important;
                border-radius: 1px !important;
                font-weight: bold !important;
                display: inline-block !important;
                font-size: 7pt !important;
                min-width: 30px !important;
            }

            /* إظهار القيم المختارة للطباعة */
            .printed-rating {
                display: inline !important;
                font-weight: bold;
                font-size: 8pt !important;
                padding: 0 2px !important;
                background-color: #f0f0f0;
                border-radius: 1px;
                border: 1px solid #666;
                margin-right: 2px !important;
            }

            /* ========== COMPACT SUMMARY ========== */
            .summary-container {
                background: #f0f0f0 !important;
                color: black !important;
                border: 1px solid #000 !important;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                padding: 8px !important;
                margin: 8px 0 !important;
            }

            .summary-grid {
                display: grid !important;
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 8px !important;
                text-align: center;
            }

            .summary-item {
                background: white !important;
                border: 1px solid #000 !important;
                color: black !important;
                padding: 6px !important;
                margin: 0 !important;
            }

            .summary-title {
                color: #000 !important;
                font-size: 10pt !important;
                margin-bottom: 8px !important;
            }

            .summary-label {
                font-size: 7pt !important;
                margin-bottom: 3px !important;
            }

            .summary-value {
                font-size: 12pt !important;
                font-weight: 700 !important;
                margin: 3px 0 !important;
            }

            .summary-subtext {
                font-size: 6pt !important;
            }

            /* ========== COMPACT TOTAL SCORE ========== */
            .total-score-container {
                background: #e9ecef !important;
                color: black !important;
                border: 1px solid #000 !important;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                padding: 12px !important;
                margin: 8px 0 !important;
                text-align: center;
            }

            .total-score-label {
                font-size: 9pt !important;
                margin-bottom: 3px !important;
            }

            .total-score-value {
                font-size: 20pt !important;
                font-weight: 800 !important;
                margin: 3px 0 !important;
            }

            .total-score-grade {
                font-size: 10pt !important;
                font-weight: 600 !important;
                margin-top: 3px !important;
                padding: 3px 8px !important;
                background: rgba(255, 255, 255, 0.5);
                border-radius: 15px;
                display: inline-block;
            }

            .progress-container {
                display: none !important;
            }

            /* ========== COMPACT NOTES ========== */
            .notes-summary {
                background: #f0f0f0 !important;
                color: black !important;
                border: 1px solid #000 !important;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                padding: 8px !important;
                margin: 8px 0 !important;
            }

            .notes-summary-title {
                color: #000 !important;
                font-size: 10pt !important;
                margin-bottom: 6px !important;
            }

            .printed-notes {
                display: block !important;
                background: white !important;
                border: 1px solid #000 !important;
                padding: 4px !important;
                margin-top: 3px !important;
                margin-bottom: 6px !important;
                min-height: 30px !important;
                max-height: 60px !important;
                white-space: pre-wrap !important;
                font-size: 7pt !important;
                overflow: hidden !important;
            }

            /* ========== COMPACT SIGNATURES ========== */
            .print-signatures {
                display: block !important;
                margin-top: 15px !important;
                border-top: 2px solid #000;
                padding-top: 8px;
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            .print-signatures h3 {
                text-align: center;
                margin-bottom: 10px !important;
                font-size: 10pt !important;
                font-weight: bold;
            }

            .signature-box {
                border: 1px solid #000;
                padding: 6px;
                height: 60px !important;
                margin-top: 6px !important;
                text-align: center;
                position: relative;
                page-break-inside: avoid !important;
            }

            .signature-line {
                border-top: 1px solid #000;
                margin-top: 25px !important;
                width: 100%;
                position: absolute;
                bottom: 20px !important;
                left: 0;
            }

            .signature-date {
                position: absolute;
                bottom: 8px !important;
                left: 50%;
                transform: translateX(-50%);
                font-size: 7pt !important;
            }

            .signature-name {
                position: absolute;
                bottom: 30px !important;
                left: 50%;
                transform: translateX(-50%);
                font-weight: bold;
                font-size: 8pt !important;
            }

            /* ========== PAGE BREAK CONTROL ========== */
            h1, h2, h3, h4 {
                page-break-after: avoid !important;
                page-break-inside: avoid !important;
            }

            table {
                page-break-inside: auto !important;
            }

            tr {
                page-break-inside: avoid !important;
                page-break-after: auto !important;
            }

            td, th {
                page-break-inside: avoid !important;
                page-break-before: auto !important;
            }

            /* تجنب تقسيم الصفوف في الجداول */
            .criteria-table tr {
                height: 18px !important;
                max-height: 18px !important;
                page-break-inside: avoid !important;
            }

            /* ========== COMPRESS TABLE LAYOUT ========== */
            .criteria-table th:nth-child(2),  /* إخفاء عمود الوصف */
            .criteria-table td:nth-child(2) {
                display: none !important;
            }

            .criteria-table th:nth-child(1) { width: 40% !important; }
            .criteria-table th:nth-child(3) { width: 15% !important; }
            .criteria-table th:nth-child(4) { width: 20% !important; }
            .criteria-table th:nth-child(5) { width: 25% !important; }

            /* ========== REMOVE UNNECESSARY SPACING ========== */
            * {
                margin-top: 0 !important;
                margin-bottom: 0 !important;
                padding-top: 0 !important;
                padding-bottom: 0 !important;
            }

            /* ========== PRINT WATERMARK ========== */
            body::after {
                content: "Valencia Marble & Natural Stone Company";
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) rotate(-45deg);
                font-size: 30pt !important;  /* تقليل حجم الـ watermark */
                color: rgba(0, 0, 0, 0.03) !important;  /* جعله أكثر خفوتًا */
                z-index: -1;
                white-space: nowrap;
                pointer-events: none;
            }

            /* ========== FORCE SINGLE PAGE ========== */
            body, html {
                height: auto !important;
                overflow: visible !important;
            }

            /* ========== FLEXIBLE ROW HEIGHTS ========== */
            .criteria-table td {
                height: auto !important;
                min-height: 18px !important;
            }

            /* ========== COMPACT LAYOUT FOR MULTIPLE SECTIONS ========== */
            .sections-container {
                display: grid !important;
                grid-template-columns: 1fr !important;
                gap: 4px !important;
                margin: 0 !important;
            }
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .main-header h1 {
                font-size: 1.8rem;
            }

            .controls-grid,
            .notes-grid {
                grid-template-columns: 1fr;
            }

            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .criteria-table {
                display: block;
                overflow-x: auto;
            }

            .rating-btn {
                width: 35px;
                height: 35px;
            }

            .total-score-value {
                font-size: 2.5rem;
            }

            .language-switcher {
                top: 10px;
                right: 10px;
            }

            .company-logo-container {
                position: relative;
                top: 0;
                left: 0;
                margin: 0 auto 15px;
                text-align: center;
                width: 100%;
            }

            .company-logo {
                margin: 0 auto;
            }

            .logo-upload-btn {
                right: calc(50% - 40px);
                bottom: -10px;
            }
        }

        @media (max-width: 480px) {
            .main-header h1 {
                font-size: 1.5rem;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .rating-scale {
                flex-direction: column;
                align-items: center;
            }

            .rating-item {
                width: 100%;
            }

            .language-switcher {
                position: relative;
                top: 0;
                right: 0;
                margin: 10px auto;
                text-align: center;
            }

            .lang-btn {
                margin: 0 auto;
            }
        }

        /* ========== ANIMATIONS ========== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-card {
            animation: fadeIn 0.5s ease-out;
        }

        /* ========== PROGRESS BAR ========== */
        .progress-container {
            width: 100%;
            background: var(--gray-light);
            border-radius: 10px;
            margin: 15px 0;
            height: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--success-color));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* ========== NOTIFICATION ========== */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: white;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.5s ease;
            border-right: 5px solid var(--telegram-color);
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
        }

        .notification.success {
            border-right-color: var(--success-color);
        }

        .notification.error {
            border-right-color: var(--danger-color);
        }

        .notification.info {
            border-right-color: var(--telegram-color);
        }

        .notification-icon {
            font-size: 1.5rem;
        }

        .notification.success .notification-icon {
            color: var(--success-color);
        }

        .notification.error .notification-icon {
            color: var(--danger-color);
        }

        .notification.info .notification-icon {
            color: var(--telegram-color);
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--gray-color);
            margin-right: auto;
        }

        /* ========== PRINT ELEMENTS ========== */
        .print-report-header {
            display: none;
        }

        .print-signatures {
            display: none;
        }

        .notes-summary {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ========== LANGUAGE SWITCHER ========== -->
        <div class="language-switcher">
            <button id="langSwitch" class="lang-btn">
                <i class="fas fa-globe"></i>
                <span id="langText">English</span>
            </button>
        </div>

        <!-- ========== HEADER مع الشعار ========== -->
        <header class="main-header">
            <div class="company-logo-container">
                <div class="company-logo" id="companyLogo">
                    <!-- الشعار سيتم تحميله هنا -->
                </div>
                <div class="logo-upload-btn" id="logoUploadBtn" title="تغيير الشعار">
                    <i class="fas fa-camera"></i>
                </div>
            </div>
            <h1 id="headerTitle">النموذج الموحد للتقييم</h1>
            <div class="company-name" id="companyName">Valencia Marble & Natural Stone Company</div>
        </header>

        <!-- ========== MODAL لرفع الشعار ========== -->
        <div class="logo-modal" id="logoModal">
            <div class="logo-modal-content">
                <div class="logo-modal-title">
                    <i class="fas fa-image"></i>
                    <span id="logoModalTitle">رفع شعار الشركة</span>
                </div>

                <div class="logo-upload-area" id="logoUploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h3 id="logoUploadText">انقر أو اسحب الصورة هنا</h3>
                    <p id="logoUploadSubtext">الحجم الموصى به: 200x200 بكسل • الصيغ المدعومة: JPG, PNG, SVG</p>
                </div>

                <input type="file" id="logoFileInput" accept=".jpg,.jpeg,.png,.svg,.gif" style="display: none;">

                <div class="logo-preview-container" id="logoPreviewContainer" style="display: none;">
                    <h4 id="logoPreviewTitle">معاينة الشعار</h4>
                    <div class="logo-preview">
                        <img id="logoPreviewImage" src="" alt="معاينة الشعار">
                    </div>
                </div>

                <div class="logo-modal-buttons">
                    <button class="logo-modal-btn secondary" id="logoCancelBtn">
                        <i class="fas fa-times"></i>
                        <span id="logoCancelText">إلغاء</span>
                    </button>
                    <button class="logo-modal-btn primary" id="logoSaveBtn">
                        <i class="fas fa-save"></i>
                        <span id="logoSaveText">حفظ الشعار</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ========== PRINT REPORT HEADER (Hidden until print) ========== -->
        <div class="print-report-header" id="printReportHeader">
            <h1 id="printReportTitle">تقرير التقييم الموحد</h1>
            <div class="company-name">Valencia Marble & Natural Stone Company</div>

            <table class="print-info-table">
                <thead>
                    <tr>
                        <th colspan="4" id="printInfoTitle">معلومات التقييم</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th id="printEmployeeLabel">الموظف:</th>
                        <td id="printEmployeeInfo">-</td>
                        <th id="printDepartmentLabel">القسم:</th>
                        <td id="printDepartmentInfo">-</td>
                    </tr>
                    <tr>
                        <th id="printSupervisorLabel">المشرف المباشر:</th>
                        <td id="printSupervisorInfo">-</td>
                        <th id="printDateLabel">تاريخ التقييم:</th>
                        <td id="printDateInfo">-</td>
                    </tr>
                    <tr>
                        <th id="printTotalScoreLabel">النتيجة الإجمالية:</th>
                        <td id="printTotalScore">0/100</td>
                        <th id="printGradeLabel">التقدير:</th>
                        <td id="printGradeInfo">-</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ========== INSTRUCTIONS ========== -->
        <div class="instructions-container">
            <div class="instructions-title">
                <i class="fas fa-info-circle"></i>
                <span id="instructionsTitle">تعليمات التقييم</span>
            </div>
            <p id="instructionsText">يرجى قراءة التعليمات التالية بعناية قبل البدء في عملية التقييم:</p>

            <div class="instructions-grid">
                <div class="instruction-item">
                    <strong id="instructionPrincipleTitle">مبدأ التقييم:</strong>
                    <span id="instructionPrincipleText">يتم تقييم كل موظف بناءً على معايير محددة تتناسب مع طبيعة عمله</span>
                </div>
                <div class="instruction-item">
                    <strong id="instructionDurationTitle">مدة التقييم:</strong>
                    <span id="instructionDurationText">يشمل التقييم فترة العمل للشهر السابق من تاريخ التقييم</span>
                </div>
                <div class="instruction-item">
                    <strong id="instructionConfidentialTitle">سرية المعلومات:</strong>
                    <span id="instructionConfidentialText">جميع نتائج التقييم سرية وتحفظ في سجلات الموارد البشرية</span>
                </div>
                <div class="instruction-item">
                    <strong id="instructionAutoSendTitle">الإرسال التلقائي:</strong>
                    <span id="instructionAutoSendText">يتم إرسال نسخة من التقرير تلقائياً إلى قناة الموارد البشرية عند الطباعة</span>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <strong id="ratingScaleTitle">مقياس التقييم (من 1 إلى 5 نقاط):</strong>
                <div class="rating-scale">
                    <div class="rating-item">
                        <div class="rating-value">5</div>
                        <div class="rating-label" id="rating5Label">ممتاز</div>
                    </div>
                    <div class="rating-item">
                        <div class="rating-value">4</div>
                        <div class="rating-label" id="rating4Label">جيد جداً</div>
                    </div>
                    <div class="rating-item">
                        <div class="rating-value">3</div>
                        <div class="rating-label" id="rating3Label">جيد</div>
                    </div>
                    <div class="rating-item">
                        <div class="rating-value">2</div>
                        <div class="rating-label" id="rating2Label">مقبول</div>
                    </div>
                    <div class="rating-item">
                        <div class="rating-value">1</div>
                        <div class="rating-label" id="rating1Label">ضعيف</div>
                    </div>
                </div>
            </div>

            <div class="calculator-example" style="margin-top: 20px;">
                <strong id="formulaTitle">معادلة حساب النقاط:</strong> <span id="formulaText">القيمة المحسوبة = (التقييم ÷ 5) × الوزن</span>
                <br>
                <strong id="exampleTitle">مثال:</strong> <span id="exampleText">إذا كان الوزن = 8 والتقييم = 4 ← القيمة = (4 ÷ 5) × 8 = 6.4 نقطة</span>
                <br>
                <strong id="noteTitle">ملاحظة:</strong> <span id="noteText">سيتم إرسال نسخة من التقرير تلقائياً إلى قناة الموارد البشرية عند الطباعة</span>
            </div>
        </div>

        <!-- ========== CONTROLS ========== -->
        <div class="controls-container">
            <div class="controls-title">
                <i class="fas fa-cog"></i>
                <span id="settingsTitle">إعدادات التقييم</span>
            </div>

            <div class="controls-grid">
                <div class="control-group">
                    <label class="control-label">
                        <i class="fas fa-building"></i>
                        <span id="departmentLabel">القسم</span>
                    </label>
                    <select id="departmentSelect" class="department-select">
                        <option value="">-- <span class="lang-department">اختر قسمًا</span> --</option>
                        <option value="sales">🛍️ <span class="lang-sales">قسم المبيعات</span></option>
                        <option value="warehouse">📦 <span class="lang-warehouse">قسم المستودعات</span></option>
                        <option value="design">🎨 <span class="lang-design">قسم التصميم (مكتب مصر)</span></option>
                        <option value="vehicles">🚚 <span class="lang-vehicles">قسم الآليات</span></option>
                        <option value="finance">💰 <span class="lang-finance">قسم المحاسبة/المالية</span></option>
                        <option value="marketing">📱 <span class="lang-marketing">قسم التسويق الإلكتروني</span></option>
                        <option value="projects">🔨 <span class="lang-projects">قسم المشاريع</span></option>
                        <option value="marble">💎 <span class="lang-marble">قسم الرخام</span></option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label">
                        <i class="fas fa-user"></i>
                        <span id="employeeLabel">الموظف</span>
                    </label>
                    <select id="employeeSelect" class="employee-select">
                        <option value="">-- <span class="lang-employee">اختر الموظف</span> --</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label">
                        <i class="fas fa-user-tie"></i>
                        <span id="supervisorLabel">المشرف المباشر</span>
                    </label>
                    <select id="supervisorSelect" class="supervisor-select">
                        <option value="">-- <span class="lang-supervisor">اختر المشرف</span> --</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label">
                        <i class="fas fa-calendar-alt"></i>
                        <span id="dateLabel">تاريخ التقييم</span>
                    </label>
                    <input type="date" id="evaluationDate" class="evaluation-date">
                </div>
            </div>

            <button id="generateAndSend" class="btn-generate">
                <i class="fab fa-telegram"></i>
                <span id="generateButtonText">طباعة وإرسال التقرير</span>
            </button>
        </div>

        <!-- ========== CALCULATOR ========== -->
        <div class="calculator-container">
            <div class="calculator-title">
                <i class="fas fa-calculator"></i>
                <span id="calculatorTitle">حاسبة النقاط</span>
            </div>
            <div class="calculator-formula" id="calculatorFormula">
                القيمة المحسوبة = (التقييم ÷ 5) × الوزن
            </div>
            <div class="calculator-example">
                <strong id="explanationTitle">توضيح:</strong> <span id="explanationText">كل معيار له وزن محدد (بين 1-10 نقاط) وتقييم من 1-5</span>
                <br>
                <strong id="totalPointsTitle">النقاط الكلية:</strong> <span id="totalPointsText">15 نقطة للمعايير العامة + 85 نقطة لمعايير القسم = 100 نقطة إجمالاً</span>
            </div>
        </div>

        <!-- ========== NOTES SECTIONS ========== -->
        <div class="notes-section">
            <div class="notes-title">
                <i class="fas fa-edit"></i>
                <span id="notesTitle">ملاحظات التقييم</span>
            </div>
            <p id="notesText">يرجى كتابة الملاحظات الخاصة بكل قسم من أقسام التقييم:</p>

            <div class="notes-grid">
                <div class="note-group">
                    <label class="note-label">
                        <i class="fas fa-star"></i>
                        <span id="generalNotesLabel">ملاحظات المعايير العامة</span>
                    </label>
                    <textarea id="generalNotes" class="general-notes" placeholder="اكتب ملاحظاتك حول المعايير العامة هنا..."></textarea>
                </div>

                <div class="note-group">
                    <label class="note-label">
                        <i class="fas fa-briefcase"></i>
                        <span id="departmentNotesLabel">ملاحظات معايير القسم</span>
                    </label>
                    <textarea id="departmentNotes" class="department-notes" placeholder="اكتب ملاحظاتك حول معايير القسم هنا..."></textarea>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <div class="note-group">
                    <label class="note-label">
                        <i class="fas fa-comment-alt"></i>
                        <span id="overallNotesLabel">ملاحظات عامة وتوصيات</span>
                    </label>
                    <textarea id="overallNotes" class="overall-notes" placeholder="اكتب الملاحظات العامة والتوصيات هنا..."></textarea>
                </div>
            </div>
        </div>

        <!-- ========== SECTIONS CONTAINER ========== -->
        <div class="sections-container">
            <!-- General Criteria Section -->
            <div class="section-card" id="generalSection">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-star"></i>
                        <span id="generalCriteriaTitle">المعايير العامة المشتركة</span>
                    </div>
                    <div class="section-points">
                        <span class="lang-points">النقاط:</span> <span id="generalScore">0</span>/15
                    </div>
                </div>
                <div class="section-content">
                    <table class="criteria-table">
                        <thead>
                            <tr>
                                <th width="30%"><span class="lang-criteria">المعيار</span></th>
                                <th width="35%"><span class="lang-description">الوصف</span></th>
                                <th width="10%"><span class="lang-weight">الوزن</span></th>
                                <th width="15%"><span class="lang-rating">التقييم</span></th>
                                <th width="10%"><span class="lang-value">القيمة</span></th>
                            </tr>
                        </thead>
                        <tbody id="generalCriteriaBody">
                            <!-- General criteria will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Department Criteria Section -->
            <div class="section-card" id="departmentSection">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-briefcase"></i>
                        <span id="departmentCriteriaTitle">معايير القسم</span>
                    </div>
                    <div class="section-points">
                        <span class="lang-points">النقاط:</span> <span id="departmentScore">0</span>/85
                    </div>
                </div>
                <div class="section-content">
                    <div id="departmentCriteria">
                        <div style="padding: 40px; text-align: center; color: var(--gray-color);">
                            <i class="fas fa-hand-pointer" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <h3 id="selectPromptTitle" style="margin-bottom: 10px;">اختر القسم والموظف</h3>
                            <p id="selectPromptText">يرجى اختيار القسم والموظف من أعلى الصفحة لعرض معايير التقييم الخاصة به</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== SUMMARY ========== -->
        <div class="summary-container" id="summaryCard" style="display: none;">
            <div class="summary-title">
                <i class="fas fa-chart-bar"></i>
                <span id="summaryTitle">ملخص النتائج</span>
            </div>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label" id="summaryGeneralLabel">المعايير العامة</div>
                    <div class="summary-value" id="summaryGeneral">0/15</div>
                    <div class="summary-subtext"><span class="lang-outof">من</span> 15 <span class="lang-points">نقطة</span></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label" id="summaryDepartmentLabel">معايير القسم</div>
                    <div class="summary-value" id="summaryDepartment">0/85</div>
                    <div class="summary-subtext"><span class="lang-outof">من</span> 85 <span class="lang-points">نقطة</span></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label" id="summaryPercentageLabel">النسبة المئوية</div>
                    <div class="summary-value" id="summaryPercentage">0%</div>
                    <div class="summary-subtext"><span class="lang-outof">من</span> 100%</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label" id="summaryGradeLabel">التقدير</div>
                    <div class="summary-value" id="summaryGrade">-</div>
                    <div class="summary-subtext" id="summaryMessage">-</div>
                </div>
            </div>
        </div>

        <!-- ========== TOTAL SCORE ========== -->
        <div class="total-score-container" id="totalScoreDisplay" style="display: none;">
            <div class="total-score-label" id="totalScoreLabel">النتيجة الإجمالية للتقييم</div>
            <div class="total-score-value" id="finalScore">0</div>
            <div class="total-score-grade" id="scoreGrade">-</div>

            <div class="progress-container" style="max-width: 400px; margin: 20px auto;">
                <div class="progress-bar" id="scoreProgress" style="width: 0%"></div>
            </div>

            <div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.9;">
                <i class="fas fa-lightbulb"></i>
                <span id="performanceTips"></span>
            </div>
        </div>

        <!-- ========== PRINT NOTES SUMMARY ========== -->
        <div class="notes-summary" id="printNotesSummary">
            <div class="notes-summary-title">
                <i class="fas fa-edit"></i>
                <span id="printNotesTitle">ملاحظات التقييم</span>
            </div>

            <div style="margin-top: 15px;">
                <div>
                    <strong id="printGeneralNotesLabel">ملاحظات المعايير العامة:</strong>
                    <div class="printed-notes" id="printGeneralNotesContent">لا توجد ملاحظات</div>
                </div>

                <div style="margin-top: 15px;">
                    <strong id="printDepartmentNotesLabel">ملاحظات معايير القسم:</strong>
                    <div class="printed-notes" id="printDepartmentNotesContent">لا توجد ملاحظات</div>
                </div>

                <div style="margin-top: 15px;">
                    <strong id="printOverallNotesLabel">ملاحظات عامة وتوصيات:</strong>
                    <div class="printed-notes" id="printOverallNotesContent">لا توجد ملاحظات</div>
                </div>
            </div>
        </div>

        <!-- ========== PRINT SIGNATURES ========== -->
        <div class="print-signatures" id="printSignatures">
            <h3 id="signaturesTitle">التوقيعات</h3>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 40px; margin-top: 40px;">
                <div class="signature-box">
                    <div style="font-weight: bold; margin-bottom: 10px;" id="employeeSignatureTitle">توقيع الموظف المقيَّم</div>
                    <div class="signature-name" id="printEmployeeSignature"></div>
                    <div class="signature-line"></div>
                    <div class="signature-date"><span class="lang-date">التاريخ:</span> <span id="printSignatureDate1"></span></div>
                </div>
                <div class="signature-box">
                    <div style="font-weight: bold; margin-bottom: 10px;" id="supervisorSignatureTitle">توقيع المشرف المباشر</div>
                    <div class="signature-name" id="printSupervisorSignature"></div>
                    <div class="signature-line"></div>
                    <div class="signature-date"><span class="lang-date">التاريخ:</span> <span id="printSignatureDate2"></span></div>
                </div>
            </div>

            <div style="margin-top: 40px; border-top: 1px solid #000; padding-top: 20px;">
                <div class="signature-box" style="margin: 0 auto; width: 80%;">
                    <div style="font-weight: bold; margin-bottom: 10px;" id="hrSignatureTitle">توقيع الموارد البشرية</div>
                    <div class="signature-name"><span class="lang-hr">قسم الموارد البشرية</span></div>
                    <div class="signature-line"></div>
                    <div class="signature-date"><span class="lang-date">التاريخ:</span> <span id="printSignatureDate3"></span></div>
                </div>
            </div>
        </div>

        <!-- ========== NOTIFICATION ========== -->
        <div id="notification" class="notification">
            <div class="notification-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="notification-content">
                <strong id="notificationTitle">تم الإرسال بنجاح</strong>
                <div id="notificationMessage">سيتم إرسال التقرير إلى قناة الموارد البشرية</div>
            </div>
            <button class="notification-close">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- ========== FOOTER ========== -->
        <footer class="main-footer">
            <div id="copyrightText">© 2026 Valencia Marble & Natural Stone Company - جميع الحقوق محفوظة</div>
            <div class="footer-links">
                <a href="#" class="footer-link" id="privacyLink">سياسة الخصوصية</a>
                <a href="#" class="footer-link" id="termsLink">شروط الاستخدام</a>
                <a href="#" class="footer-link" id="contactLink">اتصل بنا</a>
                <a href="#" class="footer-link" id="supportLink">الدعم الفني</a>
            </div>
        </footer>
    </div>

    <script>
        // ========== LANGUAGE MANAGEMENT ==========
        const TRANSLATIONS = {
            ar: {
                // Header
                headerTitle: "النموذج الموحد للتقييم",
                companyName: "Valencia Marble & Natural Stone Company",
                langText: "English",

                // Logo Modal
                logoModalTitle: "رفع شعار الشركة",
                logoUploadText: "انقر أو اسحب الصورة هنا",
                logoUploadSubtext: "الحجم الموصى به: 200x200 بكسل • الصيغ المدعومة: JPG, PNG, SVG",
                logoPreviewTitle: "معاينة الشعار",
                logoCancelText: "إلغاء",
                logoSaveText: "حفظ الشعار",

                // Instructions
                instructionsTitle: "تعليمات التقييم",
                instructionsText: "يرجى قراءة التعليمات التالية بعناية قبل البدء في عملية التقييم:",
                instructionPrincipleTitle: "مبدأ التقييم:",
                instructionPrincipleText: "يتم تقييم كل موظف بناءً على معايير محددة تتناسب مع طبيعة عمله",
                instructionDurationTitle: "مدة التقييم:",
                instructionDurationText: "يشمل التقييم فترة العمل للشهر السابق من تاريخ التقييم",
                instructionConfidentialTitle: "سرية المعلومات:",
                instructionConfidentialText: "جميع نتائج التقييم سرية وتحفظ في سجلات الموارد البشرية",
                instructionAutoSendTitle: "الإرسال التلقائي:",
                instructionAutoSendText: "يتم إرسال نسخة من التقرير تلقائياً إلى قناة الموارد البشرية عند الطباعة",

                // Rating Scale
                ratingScaleTitle: "مقياس التقييم (من 1 إلى 5 نقاط):",
                rating5Label: "ممتاز",
                rating4Label: "جيد جداً",
                rating3Label: "جيد",
                rating2Label: "مقبول",
                rating1Label: "ضعيف",

                // Calculator
                formulaTitle: "معادلة حساب النقاط:",
                formulaText: "القيمة المحسوبة = (التقييم ÷ 5) × الوزن",
                exampleTitle: "مثال:",
                exampleText: "إذا كان الوزن = 8 والتقييم = 4 ← القيمة = (4 ÷ 5) × 8 = 6.4 نقطة",
                noteTitle: "ملاحظة:",
                noteText: "سيتم إرسال نسخة من التقرير تلقائياً إلى قناة الموارد البشرية عند الطباعة",
                explanationTitle: "توضيح:",
                explanationText: "كل معيار له وزن محدد (بين 1-10 نقاط) وتقييم من 1-5",
                totalPointsTitle: "النقاط الكلية:",
                totalPointsText: "15 نقطة للمعايير العامة + 85 نقطة لمعايير القسم = 100 نقطة إجمالاً",
                calculatorTitle: "حاسبة النقاط",

                // Settings
                settingsTitle: "إعدادات التقييم",
                departmentLabel: "القسم",
                employeeLabel: "الموظف",
                supervisorLabel: "المشرف المباشر",
                dateLabel: "تاريخ التقييم",
                generateButtonText: "طباعة وإرسال التقرير",

                // Departments
                department: "اختر قسمًا",
                sales: "قسم المبيعات",
                warehouse: "قسم المستودعات",
                design: "قسم التصميم (مكتب مصر)",
                vehicles: "قسم الآليات",
                finance: "قسم المحاسبة/المالية",
                marketing: "قسم التسويق الإلكتروني",
                projects: "قسم المشاريع",
                marble: "قسم الرخام",
                employee: "اختر الموظف",
                supervisor: "اختر المشرف",

                // Sections
                generalCriteriaTitle: "المعايير العامة المشتركة",
                departmentCriteriaTitle: "معايير القسم",
                selectPromptTitle: "اختر القسم والموظف",
                selectPromptText: "يرجى اختيار القسم والموظف من أعلى الصفحة لعرض معايير التقييم الخاصة به",

                // Table Headers
                criteria: "المعيار",
                description: "الوصف",
                weight: "الوزن",
                rating: "التقييم",
                value: "القيمة",
                points: "النقاط",
                outof: "من",

                // Summary
                summaryTitle: "ملخص النتائج",
                summaryGeneralLabel: "المعايير العامة",
                summaryDepartmentLabel: "معايير القسم",
                summaryPercentageLabel: "النسبة المئوية",
                summaryGradeLabel: "التقدير",

                // Total Score
                totalScoreLabel: "النتيجة الإجمالية للتقييم",

                // Notes
                notesTitle: "ملاحظات التقييم",
                notesText: "يرجى كتابة الملاحظات الخاصة بكل قسم من أقسام التقييم:",
                generalNotesLabel: "ملاحظات المعايير العامة",
                departmentNotesLabel: "ملاحظات معايير القسم",
                overallNotesLabel: "ملاحظات عامة وتوصيات",
                printNotesTitle: "ملاحظات التقييم",
                printGeneralNotesLabel: "ملاحظات المعايير العامة:",
                printDepartmentNotesLabel: "ملاحظات معايير القسم:",
                printOverallNotesLabel: "ملاحظات عامة وتوصيات:",

                // Print
                printReportTitle: "تقرير التقييم الموحد",
                printInfoTitle: "معلومات التقييم",
                printEmployeeLabel: "الموظف:",
                printDepartmentLabel: "القسم:",
                printSupervisorLabel: "المشرف المباشر:",
                printDateLabel: "تاريخ التقييم:",
                printTotalScoreLabel: "النتيجة الإجمالية:",
                printGradeLabel: "التقدير:",

                // Signatures
                signaturesTitle: "التوقيعات",
                employeeSignatureTitle: "توقيع الموظف المقيَّم",
                supervisorSignatureTitle: "توقيع المشرف المباشر",
                hrSignatureTitle: "توقيع الموارد البشرية",
                hr: "قسم الموارد البشرية",
                date: "التاريخ:",

                // Footer
                copyrightText: "© 2026 Valencia Marble & Natural Stone Company - جميع الحقوق محفوظة",
                privacyLink: "سياسة الخصوصية",
                termsLink: "شروط الاستخدام",
                contactLink: "اتصل بنا",
                supportLink: "الدعم الفني",

                // General Criteria
                generalCriteria: [
                    {
                        id: 'discipline',
                        name: 'الانضباط والالتزام',
                        description: 'الحضور، الالتزام باللوائح'
                    },
                    {
                        id: 'teamwork',
                        name: 'العمل الجماعي والتعاون',
                        description: 'التعاون مع الفريق، تقبل التوجيهات'
                    },
                    {
                        id: 'productivity',
                        name: 'الإنتاجية والإنجاز',
                        description: 'إنجاز المهام في الوقت، إدارة الوقت'
                    },
                    {
                        id: 'initiative',
                        name: 'المبادرة والتحسين',
                        description: 'اقتراح تحسينات، حل المشكلات'
                    }
                ]
            },

            en: {
                // Header
                headerTitle: "Unified Evaluation Form",
                companyName: "Valencia Marble & Natural Stone Company",
                langText: "العربية",

                // Logo Modal
                logoModalTitle: "Upload Company Logo",
                logoUploadText: "Click or drag image here",
                logoUploadSubtext: "Recommended size: 200x200px • Supported formats: JPG, PNG, SVG",
                logoPreviewTitle: "Logo Preview",
                logoCancelText: "Cancel",
                logoSaveText: "Save Logo",

                // Instructions
                instructionsTitle: "Evaluation Instructions",
                instructionsText: "Please read the following instructions carefully before starting the evaluation process:",
                instructionPrincipleTitle: "Evaluation Principle:",
                instructionPrincipleText: "Each employee is evaluated based on specific criteria that match their job nature",
                instructionDurationTitle: "Evaluation Period:",
                instructionDurationText: "The evaluation covers the work period of the previous month from the evaluation date",
                instructionConfidentialTitle: "Information Confidentiality:",
                instructionConfidentialText: "All evaluation results are confidential and kept in HR records",
                instructionAutoSendTitle: "Automatic Submission:",
                instructionAutoSendText: "A copy of the report is automatically sent to the HR channel upon printing",

                // Rating Scale
                ratingScaleTitle: "Evaluation Scale (1 to 5 points):",
                rating5Label: "Excellent",
                rating4Label: "Very Good",
                rating3Label: "Good",
                rating2Label: "Acceptable",
                rating1Label: "Weak",

                // Calculator
                formulaTitle: "Points Calculation Formula:",
                formulaText: "Calculated Value = (Rating ÷ 5) × Weight",
                exampleTitle: "Example:",
                exampleText: "If weight = 8 and rating = 4 → Value = (4 ÷ 5) × 8 = 6.4 points",
                noteTitle: "Note:",
                noteText: "A copy of the report will be automatically sent to the HR channel when printing",
                explanationTitle: "Explanation:",
                explanationText: "Each criterion has a specific weight (1-10 points) and rating from 1-5",
                totalPointsTitle: "Total Points:",
                totalPointsText: "15 points for general criteria + 85 points for department criteria = 100 points total",
                calculatorTitle: "Points Calculator",

                // Settings
                settingsTitle: "Evaluation Settings",
                departmentLabel: "Department",
                employeeLabel: "Employee",
                supervisorLabel: "Direct Supervisor",
                dateLabel: "Evaluation Date",
                generateButtonText: "Print and Send Report",

                // Departments
                department: "Select a department",
                sales: "Sales Department",
                warehouse: "Warehouse Department",
                design: "Design Department (Egypt Office)",
                vehicles: "Vehicles Department",
                finance: "Accounting/Finance Department",
                marketing: "Digital Marketing Department",
                projects: "Projects Department",
                marble: "Marble Department",
                employee: "Select an employee",
                supervisor: "Select a supervisor",

                // Sections
                generalCriteriaTitle: "General Shared Criteria",
                departmentCriteriaTitle: "Department Criteria",
                selectPromptTitle: "Select Department and Employee",
                selectPromptText: "Please select the department and employee from above to display their evaluation criteria",

                // Table Headers
                criteria: "Criterion",
                description: "Description",
                weight: "Weight",
                rating: "Rating",
                value: "Value",
                points: "Points",
                outof: "out of",

                // Summary
                summaryTitle: "Results Summary",
                summaryGeneralLabel: "General Criteria",
                summaryDepartmentLabel: "Department Criteria",
                summaryPercentageLabel: "Percentage",
                summaryGradeLabel: "Grade",

                // Total Score
                totalScoreLabel: "Total Evaluation Score",

                // Notes
                notesTitle: "Evaluation Notes",
                notesText: "Please write notes for each section of the evaluation:",
                generalNotesLabel: "General Criteria Notes",
                departmentNotesLabel: "Department Criteria Notes",
                overallNotesLabel: "Overall Notes and Recommendations",
                printNotesTitle: "Evaluation Notes",
                printGeneralNotesLabel: "General Criteria Notes:",
                printDepartmentNotesLabel: "Department Criteria Notes:",
                printOverallNotesLabel: "Overall Notes and Recommendations:",

                // Print
                printReportTitle: "Unified Evaluation Report",
                printInfoTitle: "Evaluation Information",
                printEmployeeLabel: "Employee:",
                printDepartmentLabel: "Department:",
                printSupervisorLabel: "Direct Supervisor:",
                printDateLabel: "Evaluation Date:",
                printTotalScoreLabel: "Total Score:",
                printGradeLabel: "Grade:",

                // Signatures
                signaturesTitle: "Signatures",
                employeeSignatureTitle: "Evaluated Employee Signature",
                supervisorSignatureTitle: "Direct Supervisor Signature",
                hrSignatureTitle: "Human Resources Signature",
                hr: "Human Resources Department",
                date: "Date:",

                // Footer
                copyrightText: "© 2026 Valencia Marble & Natural Stone Company - All Rights Reserved",
                privacyLink: "Privacy Policy",
                termsLink: "Terms of Use",
                contactLink: "Contact Us",
                supportLink: "Technical Support",

                // General Criteria
                generalCriteria: [
                    {
                        id: 'discipline',
                        name: 'Discipline and Commitment',
                        description: 'Attendance, compliance with regulations'
                    },
                    {
                        id: 'teamwork',
                        name: 'Teamwork and Cooperation',
                        description: 'Team collaboration, acceptance of guidance'
                    },
                    {
                        id: 'productivity',
                        name: 'Productivity and Achievement',
                        description: 'Task completion on time, time management'
                    },
                    {
                        id: 'initiative',
                        name: 'Initiative and Improvement',
                        description: 'Suggesting improvements, problem solving'
                    }
                ]
            }
        };

        // ========== التهيئة والإعدادات ==========
        const CONFIG = {
            BOT_TOKEN: "8211546767:AAHzI71x7Tj06MaJ2I8N1DI92zFmn_ZIHeg",
            HR_CHANNEL: "-1003528917325",
            SCORES: {
                GENERAL_MAX: 15,
                DEPARTMENT_MAX: 85,
                TOTAL_MAX: 100
            }
        };

        // ========== إدارة الشعار ==========
        class LogoManager {
            constructor() {
                this.logoElement = document.getElementById('companyLogo');
                this.logoUploadBtn = document.getElementById('logoUploadBtn');
                this.logoModal = document.getElementById('logoModal');
                this.logoFileInput = document.getElementById('logoFileInput');
                this.logoUploadArea = document.getElementById('logoUploadArea');
                this.logoPreviewContainer = document.getElementById('logoPreviewContainer');
                this.logoPreviewImage = document.getElementById('logoPreviewImage');
                this.logoCancelBtn = document.getElementById('logoCancelBtn');
                this.logoSaveBtn = document.getElementById('logoSaveBtn');

                // الشعار الافتراضي كـ Base64 (شعار بسيط)
                this.defaultLogo = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjEwMCIgY3k9IjEwMCIgcj0iOTUiIGZpbGw9IiM4QjczNTUiIHN0cm9rZT0iIzJDM0U1MCIgc3Ryb2tlLXdpZHRoPSI1Ii8+CjxwYXRoIGQ9Ik01MCAxMDBMMTAwIDUwTDE1MCAxMDBMMTAwIDE1MFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik03NSAxMDBMMTAwIDc1TDEyNSAxMDBMMTAwIDEyNVoiIGZpbGw9IiMyQzNFNTAiIGZpbGwtb3BhY2l0eT0iMC43Ii8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTMwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiBmb250LXdlaWdodD0iYm9sZCI+VkFMRU5DSUE8L3RleHQ+Cjwvc3ZnPgo=';

                this.init();
            }

            init() {
                // تحميل الشعار المحفوظ أو استخدام الافتراضي
                this.loadLogo();

                // إضافة مستمعي الأحداث
                this.bindEvents();
            }

            bindEvents() {
                // زر رفع الشعار
                this.logoUploadBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.openModal();
                });

                // منطقة رفع الملف
                this.logoUploadArea.addEventListener('click', () => {
                    this.logoFileInput.click();
                });

                // سحب وإفلات الملف
                this.logoUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.logoUploadArea.style.borderColor = 'var(--primary-color)';
                    this.logoUploadArea.style.background = 'var(--light-color)';
                });

                this.logoUploadArea.addEventListener('dragleave', () => {
                    this.logoUploadArea.style.borderColor = 'var(--gray-light)';
                    this.logoUploadArea.style.background = 'white';
                });

                this.logoUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.logoUploadArea.style.borderColor = 'var(--gray-light)';
                    this.logoUploadArea.style.background = 'white';

                    if (e.dataTransfer.files.length > 0) {
                        this.handleFileSelect(e.dataTransfer.files[0]);
                    }
                });

                // اختيار الملف
                this.logoFileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.handleFileSelect(e.target.files[0]);
                    }
                });

                // أزرار المودال
                this.logoCancelBtn.addEventListener('click', () => this.closeModal());
                this.logoSaveBtn.addEventListener('click', () => this.saveLogo());

                // إغلاق المودال بالنقر خارج المحتوى
                this.logoModal.addEventListener('click', (e) => {
                    if (e.target === this.logoModal) {
                        this.closeModal();
                    }
                });
            }

            openModal() {
                this.logoModal.classList.add('show');
                // إعادة تعيين المعاينة
                this.logoPreviewContainer.style.display = 'none';
                this.logoFileInput.value = '';
            }

            closeModal() {
                this.logoModal.classList.remove('show');
            }

            handleFileSelect(file) {
                // التحقق من نوع الملف
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/svg+xml', 'image/gif'];
                if (!validTypes.includes(file.type)) {
                    alert('نوع الملف غير مدعوم. الرجاء اختيار صورة بصيغة JPG, PNG, SVG, أو GIF.');
                    return;
                }

                // التحقق من حجم الملف (5MB كحد أقصى)
                if (file.size > 5 * 1024 * 1024) {
                    alert('حجم الملف كبير جداً. الحد الأقصى هو 5 ميجابايت.');
                    return;
                }

                // قراءة الملف وتحويله لـ Base64
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.logoPreviewImage.src = e.target.result;
                    this.logoPreviewContainer.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }

            saveLogo() {
                if (!this.logoPreviewImage.src || this.logoPreviewImage.src === '') {
                    alert('الرجاء اختيار صورة أولاً.');
                    return;
                }

                // حفظ الشعار في localStorage
                localStorage.setItem('company_logo', this.logoPreviewImage.src);

                // تحديث الشعار في الواجهة
                this.updateLogo(this.logoPreviewImage.src);

                // إغلاق المودال
                this.closeModal();

                // إظهار إشعار النجاح
                this.showSuccessNotification('تم حفظ الشعار بنجاح');
            }

            loadLogo() {
                // محاولة تحميل الشعار من localStorage
                const savedLogo = localStorage.getItem('company_logo');

                if (savedLogo) {
                    this.updateLogo(savedLogo);
                } else {
                    // استخدام الشعار الافتراضي
                    this.updateLogo(this.defaultLogo);
                }
            }

            updateLogo(logoData) {
                // مسح محتوى الشعار الحالي
                this.logoElement.innerHTML = '';

                // إنشاء عنصر الصورة
                const img = document.createElement('img');
                img.src = logoData;
                img.alt = 'شعار الشركة';
                img.onload = () => {
                    console.log('تم تحميل الشعار بنجاح');
                };
                img.onerror = () => {
                    console.error('فشل تحميل الشعار');
                    // استخدام الشعار الافتراضي في حالة الفشل
                    this.useDefaultLogo();
                };

                this.logoElement.appendChild(img);

                // تحديث الشعار في تقرير الطباعة
                this.updatePrintLogo(logoData);
            }

            useDefaultLogo() {
                this.logoElement.innerHTML = `
                    <div class="logo-placeholder">
                        <span>V</span>
                    </div>
                `;
                localStorage.removeItem('company_logo');
            }

            updatePrintLogo(logoData) {
                // هذه الدالة ستضمن ظهور الشعار في الطباعة
                const style = document.createElement('style');
                style.innerHTML = `
                    @media print {
                        .company-logo img {
                            content: url(${logoData});
                        }
                    }
                `;
                document.head.appendChild(style);
            }

            showSuccessNotification(message) {
                // إنشاء إشعار مؤقت
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 50%;
                    transform: translateX(50%);
                    background: var(--success-color);
                    color: white;
                    padding: 12px 24px;
                    border-radius: var(--border-radius);
                    box-shadow: var(--box-shadow);
                    z-index: 10000;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    animation: slideIn 0.3s ease-out;
                `;

                notification.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <span>${message}</span>
                `;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease-out';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);

                // إضافة أنيميشن للـ CSS
                if (!document.querySelector('#notification-animations')) {
                    const style = document.createElement('style');
                    style.id = 'notification-animations';
                    style.innerHTML = `
                        @keyframes slideIn {
                            from { transform: translateX(50%) translateY(-100px); opacity: 0; }
                            to { transform: translateX(50%) translateY(0); opacity: 1; }
                        }
                        @keyframes slideOut {
                            from { transform: translateX(50%) translateY(0); opacity: 1; }
                            to { transform: translateX(50%) translateY(-100px); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }

            // دالة لاستخراج الشعار كـ Base64
            getLogoAsBase64() {
                const img = this.logoElement.querySelector('img');
                if (img && img.src) {
                    return img.src;
                }
                return this.defaultLogo;
            }

            // دالة لتعيين الشعار من Base64 مباشرة
            setLogoFromBase64(base64String) {
                if (base64String && base64String.startsWith('data:image')) {
                    localStorage.setItem('company_logo', base64String);
                    this.updateLogo(base64String);
                }
            }
        }

        // ========== هيكل البيانات ==========
        const ORGANIZATION_DATA = {
            general: [
                { id: 'discipline', name: { ar: 'الانضباط والالتزام', en: 'Discipline and Commitment' },
                  description: { ar: 'الحضور، الالتزام باللوائح', en: 'Attendance, compliance with regulations' }, weight: 3 },
                { id: 'teamwork', name: { ar: 'العمل الجماعي والتعاون', en: 'Teamwork and Cooperation' },
                  description: { ar: 'التعاون مع الفريق، تقبل التوجيهات', en: 'Team collaboration, acceptance of guidance' }, weight: 4 },
                { id: 'productivity', name: { ar: 'الإنتاجية والإنجاز', en: 'Productivity and Achievement' },
                  description: { ar: 'إنجاز المهام في الوقت، إدارة الوقت', en: 'Task completion on time, time management' }, weight: 4 },
                { id: 'initiative', name: { ar: 'المبادرة والتحسين', en: 'Initiative and Improvement' },
                  description: { ar: 'اقتراح تحسينات، حل المشكلات', en: 'Suggesting improvements, problem solving' }, weight: 4 }
            ],

            departments: {
                sales: {
                    name: { ar: '🛍️ قسم المبيعات', en: '🛍️ Sales Department' },
                    manager: 'ركان (المدير العام للأقسام)',
                    teams: {
                        sharjah_sales: {
                            name: { ar: 'فريق مبيعات الشارقة', en: 'Sharjah Sales Team' },
                            supervisor: 'ركان',
                            employees: [
                                { id: 'tanweer', name: 'تنوير أنور احمد انور', position: { ar: 'مندوب مبيعات', en: 'Sales Representative' } },
                                { id: 'omar', name: 'عمر ياسر الرفاعي', position: { ar: 'مندوب مبيعات', en: 'Sales Representative' } },
                                { id: 'fadi', name: 'فادي يوسف عرسالي', position: { ar: 'مندوب مبيعات', en: 'Sales Representative' } }
                            ]
                        },
                        abu_dhabi_branch: {
                            name: { ar: 'فرع أبوظبي', en: 'Abu Dhabi Branch' },
                            supervisor: 'محمد علي',
                            employees: [
                                { id: 'tariq', name: 'طارق هربس', position: { ar: 'مندوب مبيعات', en: 'Sales Representative' } },
                                { id: 'nour', name: 'نور الريس', position: { ar: 'مندوب مبيعات', en: 'Sales Representative' } }
                            ]
                        }
                    },
                    criteria: {
                        sales_rep: [
                            { id: 'appearance', name: { ar: 'المظهر الخارجي', en: 'External Appearance' },
                              description: { ar: 'اللباس، تسريحة الشعر، النظافة', en: 'Clothing, hairstyle, cleanliness' }, weight: 5 },
                            { id: 'customer_interaction', name: { ar: 'التعامل مع العميل', en: 'Customer Interaction' },
                              description: { ar: 'اللباقة، الاحترافية، مهارات الاتصال', en: 'Politeness, professionalism, communication skills' }, weight: 8 },
                            { id: 'response_speed', name: { ar: 'الاستجابة السريعة', en: 'Quick Response' },
                              description: { ar: 'سرعة الرد على الاستفسارات', en: 'Quick response to inquiries' }, weight: 6 },
                            { id: 'after_sales', name: { ar: 'حل المشاكل ما بعد البيع', en: 'After-Sales Problem Solving' },
                              description: { ar: 'متابعة الشكاوى، إرضاء العملاء', en: 'Follow-up on complaints, customer satisfaction' }, weight: 7 },
                            { id: 'old_customers', name: { ar: 'متابعة العملاء القدامى', en: 'Follow-up with Old Customers' },
                              description: { ar: 'الاتصال الدوري، تجديد العلاقات', en: 'Periodic contact, relationship renewal' }, weight: 6 },
                            { id: 'pricing_negotiation', name: { ar: 'قدرات البيع ضمن حدود السعر', en: 'Pricing Negotiation Skills' },
                              description: { ar: 'المرونة في التفاوض', en: 'Flexibility in negotiation' }, weight: 7 },
                            { id: 'quotation_pricing', name: { ar: 'تسعير عروض الأسعار', en: 'Quotation Pricing' },
                              description: { ar: 'الدقة، التنافسية', en: 'Accuracy, competitiveness' }, weight: 7 },
                            { id: 'sales_network', name: { ar: 'قبول شب المبيسات للعميل', en: 'Accepting Customer Network Preferences' },
                              description: { ar: 'تقديم البدائل المناسبة', en: 'Providing suitable alternatives' }, weight: 6 },
                            { id: 'product_knowledge', name: { ar: 'حفظ المواد بالمواصفات', en: 'Product Knowledge' },
                              description: { ar: 'المعرفة بالمنتجات', en: 'Knowledge of products' }, weight: 7 },
                            { id: 'stone_info', name: { ar: 'حفظ معلومات الحجر', en: 'Stone Information Knowledge' },
                              description: { ar: 'المعرفة بالأنواع والجودة', en: 'Knowledge of types and quality' }, weight: 7 },
                            { id: 'selling_slow_moving', name: { ar: 'القدرة على بيع الأصناف الراكدة', en: 'Ability to Sell Slow-Moving Items' },
                              description: { ar: 'الإقناع، العروض الخاصة', en: 'Persuasion, special offers' }, weight: 6 }
                        ],
                        delivery_staff: [
                            { id: 'delivery_speed', name: { ar: 'سرعة التوصيل', en: 'Delivery Speed' },
                              description: { ar: 'الالتزام بالمواعيد', en: 'Commitment to schedules' }, weight: 8 },
                            { id: 'professional_interaction', name: { ar: 'التعامل المهني مع العملاء', en: 'Professional Interaction with Customers' },
                              description: { ar: 'اللباقة، حل المشكلات', en: 'Politeness, problem solving' }, weight: 7 },
                            { id: 'goods_safety', name: { ar: 'سلامة البضائع', en: 'Goods Safety' },
                              description: { ar: 'العناية أثناء النقل', en: 'Care during transportation' }, weight: 8 },
                            { id: 'route_planning', name: { ar: 'تنظيم وتخطيط المسارات', en: 'Route Planning and Organization' },
                              description: { ar: 'الكفاءة في التنقل', en: 'Travel efficiency' }, weight: 7 }
                        ],
                        delivery_workers: [
                            { id: 'loading_speed', name: { ar: 'سرعة تحميل وتنزيل البضائع', en: 'Loading and Unloading Speed' }, weight: 9 },
                            { id: 'goods_arrangement', name: { ar: 'ترتيب البضائع بشكل آمن', en: 'Safe Goods Arrangement' }, weight: 8 },
                            { id: 'delivery_instructions', name: { ar: 'الالتزام بتعليمات التسليم', en: 'Adherence to Delivery Instructions' }, weight: 8 }
                        ]
                    }
                },

                warehouse: {
                    name: { ar: '📦 قسم المستودعات', en: '📦 Warehouse Department' },
                    manager: 'ماجد يوسف',
                    teams: {
                        main_warehouse: {
                            name: { ar: 'المستودع الرئيسي (برنس)', en: 'Main Warehouse (Prince)' },
                            supervisor: 'برنس',
                            employees: [
                                { id: 'maged', name: 'ماجد يوسف', position: { ar: 'مستودعات', en: 'Warehouse Worker' } },
                                { id: 'prince', name: 'برينس انوبيل', position: { ar: 'موظف تسليم', en: 'Warehouse Worker' } },
                                { id: 'mohieddin', name: 'محي الدين', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } },
                                { id: 'othman', name: 'عثمان', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } },
                                { id: 'nouri', name: 'نوري', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } },
                                { id: 'youssef', name: 'يوسف', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } },
                                { id: 'siraj', name: 'سراج', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } },
                                { id: 'manouri', name: 'مانوري', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } },
                                { id: 'benjamin', name: 'بنجامين', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } },
                                { id: 'bashirwa', name: 'بشيروا', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } }
                            ]
                        },
                        sharjah_warehouse: {
                            name: { ar: 'مستودع الشارقة 1', en: 'Abu Dhabi Warehouse' },
                            supervisor: 'أحمد علي',
                            employees: [
                                { id: 'ahmed_ali', name: 'احمد علي', position: { ar: 'عامل تسليم', en: 'Warehouse Worker' } },
                                { id: 'ahmed_mohamed', name: 'احمد محمد علي زعرب', position: { ar: 'موظف ادخالات', en: 'Warehouse Worker' } },
                                { id: 'bruno', name: 'برونو', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } },
                                { id: 'abdulrahman', name: 'عبدالرحمن', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } }
                            ]
                        },
                        abu_dhabi_warehouse: {
                            name: { ar: 'مستودع ابوظبي', en: 'Abu Dhabi Warehouse' },
                            supervisor: 'محمد على',
                            employees: [
                                { id: 'anas', name: 'انس عنطوز', position: { ar: 'موظف ادخالات', en: 'Warehouse Worker' } },
                                { id: 'imanwel', name: 'ايمانويل داركو', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } },
                                { id: 'beter', name: 'بيتر', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } },
                                { id: 'imanwel_yabua', name: 'ايمانويل يابوا', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } },
                                { id: 'francies', name: 'فرانسيس', position: { ar: 'عامل مستودع', en: 'Warehouse Worker' } }
                            ]
                        }
                    },
                    criteria: [
                        { id: 'order_distribution', name: { ar: 'توزيع الأوامر', en: 'Order Distribution' },
                          description: { ar: 'الدقة، التنظيم', en: 'Accuracy, organization' }, weight: 8 },
                        { id: 'personal_cleanliness', name: { ar: 'النظافة الشخصية', en: 'Personal Cleanliness' },
                          description: { ar: 'نظافة الزي، النظافة العامة', en: 'Uniform cleanliness, general cleanliness' }, weight: 6 },
                        { id: 'new_tasks', name: { ar: 'قبول مهام جديدة والتكيف معها', en: 'Accepting and Adapting to New Tasks' },
                          description: { ar: 'المرونة', en: 'Flexibility' }, weight: 7 },
                        { id: 'physical_strength', name: { ar: 'القوة البدنية', en: 'Physical Strength' },
                          description: { ar: 'القدرة على حمل الأوزان', en: 'Ability to carry weights' }, weight: 6 },
                        { id: 'stone_repair', name: { ar: 'إصلاح الحجر المكسور', en: 'Repair of Broken Stone' },
                          description: { ar: 'المهارة، الإبداع في الإصلاح', en: 'Skill, creativity in repair' }, weight: 7 },
                        { id: 'storage_accuracy', name: { ar: 'دقة التخزين والجرد', en: 'Storage and Inventory Accuracy' }, weight: 9 },
                        { id: 'task_speed', name: { ar: 'سرعة تنفيذ المهام', en: 'Task Execution Speed' }, weight: 8 },
                        { id: 'safety_procedures', name: { ar: 'الالتزام بإجراءات السلامة', en: 'Adherence to Safety Procedures' }, weight: 8 }
                    ]
                },

                design: {
                    name: { ar: '🎨 قسم التصميم (مكتب مصر)', en: '🎨 Design Department (Egypt Office)' },
                    manager: 'رمضان',
                    employees: [
                        { id: 'ramadan', name: 'رمضان', position: { ar: 'مصمم', en: 'Designer' } },
                        { id: 'hana', name: 'هناء', position: { ar: 'مصممة', en: 'Designer' } },
                        { id: 'bushra', name: 'بشرى', position: { ar: 'مصممة', en: 'Designer' } },
                    ],
                    criteria: [
                        { id: '3d_accuracy', name: { ar: 'معدل دقة الـ3D', en: '3D Accuracy Rate' },
                          description: { ar: 'التفاصيل، الواقعية', en: 'Details, realism' }, weight: 9 },
                        { id: 'quotation_speed', name: { ar: 'سرعة تنفيذ عرض السعر', en: 'Quotation Execution Speed' },
                          description: { ar: 'الكفاءة', en: 'Efficiency' }, weight: 8 },
                        { id: 'quick_wit', name: { ar: 'سرعة البديهة', en: 'Quick Wit' },
                          description: { ar: 'رد الفعل، الحلول السريعة', en: 'Reaction, quick solutions' }, weight: 7 },
                        { id: 'design_problems', name: { ar: 'حل المشاكل التصميمية', en: 'Solving Design Problems' },
                          description: { ar: 'الإبداع في الحلول', en: 'Creativity in solutions' }, weight: 8 },
                        { id: 'quantity_accuracy', name: { ar: 'دقة الكميات والحسابات', en: 'Quantity and Calculation Accuracy' }, weight: 9 },
                        { id: 'material_knowledge', name: { ar: 'حفظ المواد والديكورات بالمواصفات', en: 'Material and Decor Knowledge' }, weight: 7 },
                        { id: 'quotation_pricing', name: { ar: 'تسعير عروض الأسعار', en: 'Quotation Pricing' },
                          description: { ar: 'الدقة، التنافسية', en: 'Accuracy, competitiveness' }, weight: 8 },
                        { id: 'delivery_deadlines', name: { ar: 'الالتزام بمواعيد التسليم', en: 'Adherence to Delivery Deadlines' }, weight: 7 }
                    ]
                },

                vehicles: {
                    name: { ar: '🚚 قسم الآليات', en: '🚚 Vehicles Department' },
                    manager: 'احمد ماهر',
                    teams: {
                        forklift_drivers: {
                            name: { ar: 'سائقي الرافعات الشوكية', en: 'Forklift Drivers' },
                            supervisor: 'احمد ماهر',
                            employees: [
                                { id: 'ahmed_maher', name: 'احمد ماهر', position: { ar: 'الأليات', en: 'Forklift Driver' } },
                                { id: 'mohamed_albadri_ahmed_mohamed', name: 'محمد البدري احمد محمد', position: { ar: 'سائق رافعة شوكية', en: 'Forklift Driver' } },
                                { id: 'michael', name: 'مايكل', position: { ar: 'سائق رافعة شوكية', en: 'Forklift Driver' } },
                                { id: 'hassan_mohamed_alsaed_salem', name: 'حسن محمد السيد سالم', position: { ar: 'سائق رافعة شوكية', en: 'Forklift Driver' } },
                                { id: 'ogastin', name: 'اوجستين بواكى', position: { ar: 'سائق رافعة شوكية', en: 'Forklift Driver' } }
                            ]
                        },
                        shipping_drivers: {
                            name: { ar: 'سائقي الشحن والنقل', en: 'Shipping and Transport Drivers' },
                            supervisor: 'احمد ماهر',
                            employees: [
                                { id: 'ahmed_vehicles', name: 'احمد', position: { ar: 'سائق شحن', en: 'Shipping Driver' } },
                                { id: 'abou_alhassan', name: 'ابوالحسن محمد الياس', position: { ar: 'سائق شحن', en: 'Shipping Driver' } },
                                { id: 'amir', name: 'امير حمزة عطاء الله', position: { ar: 'سائق شحن', en: 'Shipping Driver' } },
                                { id: 'mastaz', name: 'مستاز منور منور حسين', position: { ar: 'سائق شحن', en: 'Shipping Driver' } }
                            ]
                        }
                    },
                    criteria: {
                        forklift_drivers: [
                            { id: 'driver_experience', name: { ar: 'خبرة السائق', en: 'Driver Experience' },
                              description: { ar: 'المهارة، الأمان', en: 'Skill, safety' }, weight: 9 },
                            { id: 'periodic_maintenance', name: { ar: 'الصيانة الدورية', en: 'Periodic Maintenance' },
                              description: { ar: 'الالتزام، الإبلاغ', en: 'Commitment, reporting' }, weight: 7 },
                            { id: 'forklift_cleanliness', name: { ar: 'النظافة العامة للفوركليفت', en: 'Forklift General Cleanliness' }, weight: 6 },
                            { id: 'driving_experience', name: { ar: 'الخبرة في القيادة', en: 'Driving Experience' },
                              description: { ar: 'الداخلية، المناورة', en: 'Indoors, maneuvering' }, weight: 8 },
                            { id: 'loading_experience', name: { ar: 'خبرة التحميل والتنزيل', en: 'Loading and Unloading Experience' },
                              description: { ar: 'الكفاءة، السلامة', en: 'Efficiency, safety' }, weight: 8 },
                            { id: 'safety_procedures', name: { ar: 'الالتزام بإجراءات السلامة', en: 'Adherence to Safety Procedures' }, weight: 7 }
                        ],
                        shipping_drivers: [
                            { id: 'vehicle_maintenance', name: { ar: 'المحافظة على السيارة', en: 'Vehicle Maintenance' },
                              description: { ar: 'العناية، النظافة', en: 'Care, cleanliness' }, weight: 8 },
                            { id: 'cleanliness', name: { ar: 'النظافة الداخلية والخارجية', en: 'Internal and External Cleanliness' }, weight: 6 },
                            { id: 'work_speed', name: { ar: 'سرعة إتمام العمل الموكل', en: 'Work Completion Speed' }, weight: 7 },
                            { id: 'crane_experience', name: { ar: 'خبرة استخدام الكرين (رافعة الباليت)', en: 'Crane (Pallet Jack) Experience' }, weight: 8 },
                            { id: 'maintenance_schedule', name: { ar: 'الالتزام بمواعيد الصيانة', en: 'Adherence to Maintenance Schedule' }, weight: 7 },
                            { id: 'fault_reporting', name: { ar: 'الإبلاغ عن الأعطال فوراً', en: 'Immediate Fault Reporting' }, weight: 7 },
                            { id: 'daily_check', name: { ar: 'الصيانة الدورية والفحص اليومي', en: 'Periodic Maintenance and Daily Check' }, weight: 7 },
                            { id: 'traffic_rules', name: { ar: 'الالتزام بقواعد المرور وتجنب المخالفات', en: 'Adherence to Traffic Rules and Avoiding Violations' }, weight: 8 }
                        ]
                    }
                },

                finance: {
                    name: { ar: '💰 قسم المحاسبة/المالية', en: '💰 Accounting/Finance Department' },
                    manager: 'مهند نيازي السلق',
                    employees: [
                        { id: 'mohamed_helmi', name: 'محمد حلمي', position: { ar: 'محاسب', en: 'Accountant' } },
                        { id: 'omar_almak', name: 'عمر المك', position: { ar: 'محاسب', en: 'Accountant' } },
                        { id: 'hamza', name: 'حمزة', position: { ar: 'محاسب', en: 'Accountant' } },
                        { id: 'mohamed_ali_finance', name: 'محمد علي', position: { ar: 'محاسب', en: 'Accountant' } },
                        { id: 'hossam', name: 'حسام', position: { ar: 'محاسب', en: 'Accountant' } }
                    ],
                    criteria: [
                        { id: 'accounting_accuracy', name: { ar: 'الدقة المحاسبية', en: 'Accounting Accuracy' },
                          description: { ar: 'إدخال البيانات، اكتشاف الأخطاء', en: 'Data entry, error detection' }, weight: 10 },
                        { id: 'timeliness', name: { ar: 'الالتزام بالمواعيد', en: 'Timeliness' },
                          description: { ar: 'التقارير، المدفوعات', en: 'Reports, payments' }, weight: 9 },
                        { id: 'confidentiality', name: { ar: 'السرية والأمانة', en: 'Confidentiality and Integrity' },
                          description: { ar: 'حفظ الأسرار، الإبلاغ عن المخالفات', en: 'Keeping secrets, reporting violations' }, weight: 9 },
                        { id: 'organization', name: { ar: 'التنظيم', en: 'Organization' },
                          description: { ar: 'السجلات، الأرشفة', en: 'Records, archiving' }, weight: 8 },
                        { id: 'accounting_standards', name: { ar: 'الالتزام بالمعايير المحاسبية', en: 'Adherence to Accounting Standards' }, weight: 8 },
                        { id: 'task_completion', name: { ar: 'إنجاز المهام المالية في الوقت', en: 'Timely Financial Task Completion' }, weight: 7 },
                        { id: 'information_confidentiality', name: { ar: 'حفظ سرية المعلومات المالية', en: 'Confidentiality of Financial Information' }, weight: 7 },
                        { id: 'records_organization', name: { ar: 'تنظيم السجلات والمستندات', en: 'Organization of Records and Documents' }, weight: 7 }
                    ]
                },

                marketing: {
    name: { ar: '📱 قسم التسويق الإلكتروني والسوشيال ميديا', en: '📱 Digital Marketing and Social Media Department' },
    manager: 'أمين أحمد حجازي',
    teams: {
        photographer: {
            name: { ar: 'فريق التصوير', en: 'Photography Team' },
            supervisor: 'أمين أحمد حجازي',
            employees: [
                {
                    id: 'ammar',
                    name: 'عمار فادي عوض',
                    position: { ar: 'مصور', en: 'Photographer' }
                }
            ],
            criteria: [
                { id: 'photo_quality', name: { ar: 'جودة التصوير', en: 'Photo Quality' }, weight: 8 },
                { id: 'content_creativity', name: { ar: 'التنوع والإبداع في المحتوى', en: 'Content Variety and Creativity' }, weight: 7 },
                { id: 'production_speed', name: { ar: 'سرعة الإنتاج', en: 'Production Speed' }, weight: 7 },
                { id: 'coordination', name: { ar: 'التنسيق مع فريق المونتاج والتسويق', en: 'Coordination with Editing and Marketing Team' }, weight: 6 },
                { id: 'peak_hours', name: { ar: 'التواجد المستمر في اوقات الذروة', en: 'Continuous Presence During Peak Hours' }, weight: 6 }
            ]
        },

        editor: {
            name: { ar: 'فريق المونتاج', en: 'Editing Team' },
            supervisor: 'أمين أحمد حجازي',
            employees: [
                {
                    id: 'samer',
                    name: 'سامر جنيد',
                    position: { ar: 'مونتاج', en: 'Video Editor' }
                }
            ],
            criteria: [
                {
                    id: 'editing_quality',
                    name: { ar: 'جودة المونتاج', en: 'Editing Quality' },
                    description: { ar: 'التصاميم والإعلانات', en: 'Designs and advertisements' },
                    weight: 8
                },
                { id: 'delivery_speed', name: { ar: 'سرعة التسليم', en: 'Delivery Speed' }, weight: 7 },
                { id: 'editing_creativity', name: { ar: 'الإبداع في التحرير', en: 'Creativity in Editing' }, weight: 7 },
                { id: 'visual_identity', name: { ar: 'الالتزام بالهوية البصرية', en: 'Adherence to Visual Identity' }, weight: 6 }
            ]
        },

        designer: {
            name: { ar: 'فريق التصميم والإعلانات', en: 'Design and Advertising Team' },
            supervisor: 'أمين أحمد حجازي',
            employees: [
                {
                    id: 'rabah',
                    name: 'رباح الحموي',
                    position: { ar: 'مصمم إعلان/ناشر/متفاعل', en: 'Ad Designer/Publisher/Engager' }
                }
            ],
            criteria: [
                { id: 'campaign_management', name: { ar: 'إدارة الحملات الإعلانية المدفوعة', en: 'Paid Advertising Campaign Management' }, weight: 7 },
                { id: 'interaction', name: { ar: 'التفاعل مع المتابعين والرد على الرسائل', en: 'Interaction with Followers and Message Response' }, weight: 8 },
                { id: 'publishing_schedule', name: { ar: 'الالتزام بجدول النشر في أوقات الذروة', en: 'Publishing Schedule and Timeliness' }, weight: 7 },
                { id: 'off_hours_response', name: { ar: 'الرد خارج اوقات الدوام', en: 'Response Outside Working Hours' }, weight: 7 },
                { id: 'page_coordination', name: { ar: 'تنسيق الصفحات والمحتوى', en: 'Page and Publication Coordination' }, weight: 6 }
            ]
        },

        social_media: {
            name: { ar: 'فريق السوشيال ميديا', en: 'Social Media Team' },
            supervisor: 'أمين أحمد حجازي',
            employees: [
                {
                    id: 'menna_allah',
                    name: 'منه الله علاء',
                    position: { ar: 'سوشيال ميديا', en: 'Social Media Specialist' }
                },
                {
                    id: 'rania',
                    name: 'رانيا فريد',
                    position: { ar: 'سوشيال ميديا', en: 'Social Media Specialist' }
                }
            ],
            criteria: [
                { id: 'campaign_management', name: { ar: 'مستوى المعلومات عن الدولة وكيفية الرد والتعامل مع شعبها', en: 'Paid Advertising Campaign Management' }, weight: 7 },
                { id: 'interaction', name: { ar: 'التفاعل مع المتابعين والرد على الرسائل', en: 'Interaction with Followers and Message Response' }, weight: 8 },
                { id: 'publishing_schedule', name: { ar: 'مدى الجاهزيه بأوقات الذروة و العروض والضغط', en: 'Publishing Schedule and Timeliness' }, weight: 7 },
                { id: 'off_hours_response', name: { ar: 'الرد خارج اوقات الدوام', en: 'Response Outside Working Hours' }, weight: 7 },
                { id: 'page_coordination', name: { ar: 'مستوى معلوماتهم و خبرتهم في مجال أعمال الشركة', en: 'Page and Publication Coordination' }, weight: 6 }
            ]
        }
    }
},

                projects: {
                    name: { ar: '🔨 قسم المشاريع', en: '🔨 Projects Department' },
                    manager: 'مامون أحمد حجازي',
                    teams: {
                        musa_team: {
                            name: { ar: 'فريق موسي ابراهيم (فورمان)', en: 'Mousa Ibrahim Team (Foreman)' },
                            supervisor: 'موسي ابراهيم',
                            employees: [
                                { id: 'mousa', name: 'موسي ابراهيم', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'omar_projects1', name: 'عمر', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'ahmed_adel', name: 'احمد عادل', position: { ar: 'عامل مشروع', en: 'Project Worker' } }
                            ]
                        },
                        ali_team: {
                            name: { ar: 'فريق علي (فورمان)', en: 'Ali Team (Foreman)' },
                            supervisor: 'علي',
                            employees: [
                                { id: 'ali', name: 'على سائق', position: { ar: 'سائق نقل عمال', en: 'Project Worker' } },
                                { id: 'momen', name: 'مؤمن', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'mohamed_aboukhader', name: 'محمد ابوخضر', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'derek', name: 'ديريك', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'dickson', name: 'ديكسون', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'abbas', name: 'عباس', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'saeed', name: 'سعيد', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'qasim', name: 'قاسم', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'najm', name: 'نجم', position: { ar: 'عامل مشروع', en: 'Project Worker' } }
                            ]
                        },
                        suhail_team: {
                            name: { ar: 'فريق سهيل (فورمان)', en: 'Suhail Team (Foreman)' },
                            supervisor: 'سهيل',
                            employees: [
                                { id: 'souhil', name: 'سهيل احمد زوالفقار', position: { ar: 'فورمان', en: 'Project Worker' } },
                                { id: 'fares_abdalla', name: 'فارس عبدالله محمد', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'ahmed_raei', name: 'احمد راعي', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'mohamed_hassan', name: 'محمد حسن', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'omran', name: 'عمران', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'lasal', name: 'لاسال', position: { ar: 'عامل مشروع', en: 'Project Worker' } }
                            ]
                        },
                        thaqib_team: {
                            name: { ar: 'فريق ثاقب (فورمان)', en: 'Thaqib Team (Foreman)' },
                            supervisor: 'ثاقب',
                            employees: [
                                { id: 'saber', name: 'صابر', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'mohamed_abdulaziz', name: 'محمد عبدالعزيز', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'ahmed_projects', name: 'احمد', position: { ar: 'عامل مشروع', en: 'Project Worker' } },
                                { id: 'mahmoud', name: 'محمود', position: { ar: 'عامل مشروع', en: 'Project Worker' } }
                            ]
                        }
                    },
                    criteria: {
                        foremen: [
                            { id: 'instructions_accuracy', name: { ar: 'تنفيذ التعليمات بدقة', en: 'Accurate Execution of Instructions' }, weight: 9 },
                            { id: 'measurements', name: { ar: 'المقاسات وشد الخيوط', en: 'Measurements and String Tension' },
                              description: { ar: 'الدقة', en: 'Accuracy' }, weight: 8 },
                            { id: 'defect_detection', name: { ar: 'عزل الحجر السيئ واكتشاف العيوب', en: 'Isolation of Bad Stone and Defect Detection' }, weight: 8 },
                            { id: 'stone_arrangement', name: { ar: 'ترتيب الحجر في الموقع', en: 'Stone Arrangement on Site' }, weight: 7 },
                            { id: 'finishing_quality', name: { ar: 'جودة التشطيب النهائي', en: 'Final Finishing Quality' }, weight: 8 },
                            { id: 'decor_arrangement', name: { ar: 'ترتيب الديكورات والإكسسوارات', en: 'Decoration and Accessories Arrangement' }, weight: 6 },
                            { id: 'scaffolding_safety', name: { ar: 'تركيب السقالات بأمان', en: 'Safe Scaffolding Installation' }, weight: 7 },
                            { id: 'installation_speed', name: { ar: 'سرعة التركيب مع الحفاظ على الجودة', en: 'Installation Speed with Quality Maintenance' }, weight: 7 },
                            { id: 'overtime', name: { ar: 'الاستعداد للعمل الإضافي', en: 'Willingness for Overtime Work' }, weight: 6 },
                            { id: 'daily_tasks', name: { ar: 'الإنجاز اليومي للمهام', en: 'Daily Task Completion' }, weight: 7 }
                        ],
                        project_workers: [
                            { id: 'instructions_following', name: { ar: 'تنفيذ التعليمات بدقة', en: 'Accurate Following of Instructions' }, weight: 8 },
                            { id: 'measurements_compliance', name: { ar: 'الالتزام بالمقاسات المطلوبة', en: 'Compliance with Required Measurements' }, weight: 8 },
                            { id: 'defect_isolation', name: { ar: 'اكتشاف وعزل الحجر المعيب', en: 'Detection and Isolation of Defective Stone' }, weight: 7 },
                            { id: 'workplace_organization', name: { ar: 'ترتيب مكان العمل', en: 'Workplace Organization' }, weight: 6 },
                            { id: 'safety_procedures', name: { ar: 'الالتزام بإجراءات السلامة', en: 'Adherence to Safety Procedures' }, weight: 7 },
                            { id: 'task_speed', name: { ar: 'سرعة إنجاز المهام', en: 'Task Completion Speed' }, weight: 7 }
                        ]
                    }
                },

                marble: {
                    name: { ar: '💎 قسم الرخام', en: '💎 Marble Department' },
                    manager: 'أنس محمد السرداني',
                    teams: {
                        project_workers: {
                            name: { ar: 'عمال مشاريع الرخام', en: 'Marble Project Workers' },
                            supervisor: 'أنس محمد السرداني',
                            employees: [
                                { id: 'marble_worker1', name: 'عامل مشروع 1', position: { ar: 'عامل مشروع رخام', en: 'Marble Project Worker' } },
                                { id: 'marble_worker2', name: 'عامل مشروع 2', position: { ar: 'عامل مشروع رخام', en: 'Marble Project Worker' } }
                            ]
                        },
                        cutting_workers: {
                            name: { ar: 'عمال قص الرخام', en: 'Marble Cutting Workers' },
                            supervisor: 'أنس محمد السلداني',
                            employees: [
                                { id: 'cutter1', name: 'عامل قص 1', position: { ar: 'عامل قص رخام', en: 'Marble Cutter' } },
                                { id: 'cutter2', name: 'عامل قص 2', position: { ar: 'عامل قص رخام', en: 'Marble Cutter' } }
                            ]
                        },
                        installation_workers: {
                            name: { ar: 'عمال تركيب الرخام', en: 'Marble Installation Workers' },
                            supervisor: 'أنس محمد السلداني',
                            employees: [
                                { id: 'installer1', name: 'عامل تركيب 1', position: { ar: 'عامل تركيب رخام', en: 'Marble Installer' } },
                                { id: 'installer2', name: 'عامل تركيب 2', position: { ar: 'عامل تركيب رخام', en: 'Marble Installer' } }
                            ]
                        },
                        finishing_workers: {
                            name: { ar: 'عمال تشطيب الرخام', en: 'Marble Finishing Workers' },
                            supervisor: 'أنس محمد السلداني',
                            employees: [
                                { id: 'finisher1', name: 'عامل تشطيب 1', position: { ar: 'عامل تشطيب رخام', en: 'Marble Finisher' } },
                                { id: 'finisher2', name: 'عامل تشطيب 2', position: { ar: 'عامل تشطيب رخام', en: 'Marble Finisher' } }
                            ]
                        }
                    },
                    criteria: {
                        project_workers: [
                            { id: 'instructions_execution', name: { ar: 'تنفيذ التعليمات بدقة', en: 'Accurate Execution of Instructions' }, weight: 8 },
                            { id: 'measurements_accuracy', name: { ar: 'الدقة في المقاسات وشد الخيوط', en: 'Accuracy in Measurements and String Tension' }, weight: 8 },
                            { id: 'stone_defect', name: { ar: 'عزل الحجر السيئ واكتشاف العيوب', en: 'Isolation of Bad Stone and Defect Detection' }, weight: 7 },
                            { id: 'stone_arrangement', name: { ar: 'ترتيب الحجر في الموقع', en: 'Stone Arrangement on Site' }, weight: 6 },
                            { id: 'work_safety', name: { ar: 'السلامة في العمل', en: 'Work Safety' }, weight: 7 },
                            { id: 'work_speed', name: { ar: 'سرعة الإنجاز', en: 'Work Speed' }, weight: 7 },
                            { id: 'material_preservation', name: { ar: 'المحافظة على المواد وتقليل الهدر', en: 'Material Preservation and Waste Reduction' }, weight: 7 }
                        ],
                        cutting_workers: [
                            { id: 'cutting_accuracy', name: { ar: 'دقة القص حسب المقاسات', en: 'Cutting Accuracy According to Measurements' }, weight: 9 },
                            { id: 'waste_reduction', name: { ar: 'تقليل الهدر في المواد', en: 'Material Waste Reduction' }, weight: 8 },
                            { id: 'machine_safety', name: { ar: 'سلامة تشغيل آلات القص', en: 'Cutting Machine Operation Safety' }, weight: 8 },
                            { id: 'edge_quality', name: { ar: 'جودة الحواف ونظافتها', en: 'Edge Quality and Cleanliness' }, weight: 7 },
                            { id: 'machine_maintenance', name: { ar: 'الصيانة البسيطة للآلات', en: 'Basic Machine Maintenance' }, weight: 6 },
                            { id: 'productivity', name: { ar: 'الإنتاجية وجودة القطع', en: 'Productivity and Cutting Quality' }, weight: 7 }
                        ],
                        installation_workers: [
                            { id: 'installation_accuracy', name: { ar: 'دقة التركيب حسب التصميم', en: 'Installation Accuracy According to Design' }, weight: 9 },
                            { id: 'installation_speed', name: { ar: 'سرعة التركيب مع الحفاظ على الجودة', en: 'Installation Speed with Quality Maintenance' }, weight: 8 },
                            { id: 'installation_alignment', name: { ar: 'تنسيق واستواء التركيب', en: 'Installation Alignment and Levelness' }, weight: 7 },
                            { id: 'tool_skills', name: { ar: 'مهارة استخدام أدوات التركيب', en: 'Installation Tool Skills' }, weight: 7 },
                            { id: 'cleaning', name: { ar: 'تنظيف المكان بعد التركيب', en: 'Cleaning After Installation' }, weight: 6 },
                            { id: 'professionalism', name: { ar: 'الاحترافية في التعامل في مواقع العملاء', en: 'Professionalism in Customer Sites' }, weight: 7 }
                        ],
                        finishing_workers: [
                            { id: 'finishing_quality', name: { ar: 'جودة التشطيب النهائي', en: 'Final Finishing Quality' },
                              description: { ar: 'صقل، تلميع', en: 'Polishing, buffing' }, weight: 9 },
                            { id: 'attention_detail', name: { ar: 'الاهتمام بالتفاصيل الدقيقة', en: 'Attention to Fine Details' }, weight: 8 },
                            { id: 'treatment_quality', name: { ar: 'جودة المعالجات النهائية', en: 'Final Treatment Quality' }, weight: 7 },
                            { id: 'safety_materials', name: { ar: 'التعامل الآمن مع مواد التشطيب', en: 'Safe Handling of Finishing Materials' }, weight: 7 },
                            { id: 'surface_protection', name: { ar: 'الحفاظ على السطح من الخدوش', en: 'Surface Protection from Scratches' }, weight: 6 },
                            { id: 'finishing_speed', name: { ar: 'سرعة إنجاز التشطيب', en: 'Finishing Completion Speed' }, weight: 7 },
                            { id: 'final_inspection', name: { ar: 'الفحص النهائي للجودة', en: 'Final Quality Inspection' }, weight: 7 }
                        ]
                    }
                }
            },

            supervisors: {
                'الادارة العليا': [
                    { id: 'samer', name: 'سامر عبد الواحد', position: { ar: 'المدير العام للشركة', en: 'Company General Manager' } },
                ],
                'قسم المحاسبة': [
                    { id: 'mohannad', name: 'مهند نيازي السلق', position: { ar: 'قسم المحاسبة', en: 'Accounting Department Manager' } }
                ],
                'قسم المبيعات': [
                    { id: 'mohamed_ali', name: 'محمد علي', position: { ar: 'فرع أبوظبي', en: 'Abu Dhabi Branch Manager' } },
                    { id: 'rekan_sales', name: 'ركان اياد', position: { ar: 'مبيعات الشارقة', en: 'Sharjah Sales Team Supervisor' } }
                ],
                'قسم المستودعات': [
                    { id: 'majed', name: 'ماجد يوسف', position: { ar: 'قسم المستودعات', en: 'Warehouse Department Manager' } }
                ],
                'قسم الآليات': [
                    { id: 'ahmed_maher', name: 'احمد ماهر', position: { ar: 'قسم الآليات', en: 'Vehicles Department Manager' } }
                ],
                'قسم التصميم': [
                    { id: 'ramadan_sup', name: 'رمضان', position: { ar: 'قسم التصميم', en: 'Design Department Manager' } }
                ],
                'قسم التسويق': [
                    { id: 'amin', name: 'أمين أحمد حجازي', position: { ar: 'قسم التسويق', en: 'Marketing Department Manager' } }
                ],
                'قسم المشاريع': [
                    { id: 'mamoun', name: 'مامون أحمد حجازي', position: { ar: 'قسم المشاريع', en: 'Projects Department Manager' } }
                ],
                'قسم الرخام': [
                    { id: 'anas_marble', name: 'أنس محمد السرداني', position: { ar: 'قسم الرخام', en: 'Marble Department Manager' } }
                ]
            }
        };

        // ========== فئة إدارة التطبيق ==========
        class EvaluationApp {
            constructor() {
                this.state = {
                    currentDepartment: '',
                    currentEmployee: '',
                    currentSupervisor: '',
                    evaluationDate: '',
                    ratings: {
                        general: new Map(),
                        department: new Map()
                    },
                    currentLanguage: 'ar',
                    notes: {
                        general: '',
                        department: '',
                        overall: ''
                    }
                };

                this.cacheElements();
                this.init();
            }

            cacheElements() {
                this.elements = {
                    langSwitch: document.getElementById('langSwitch'),
                    langText: document.getElementById('langText'),

                    // Header
                    headerTitle: document.getElementById('headerTitle'),
                    companyName: document.getElementById('companyName'),

                    // Logo Modal
                    logoModalTitle: document.getElementById('logoModalTitle'),
                    logoUploadText: document.getElementById('logoUploadText'),
                    logoUploadSubtext: document.getElementById('logoUploadSubtext'),
                    logoPreviewTitle: document.getElementById('logoPreviewTitle'),
                    logoCancelText: document.getElementById('logoCancelText'),
                    logoSaveText: document.getElementById('logoSaveText'),

                    // Instructions
                    instructionsTitle: document.getElementById('instructionsTitle'),
                    instructionsText: document.getElementById('instructionsText'),
                    instructionPrincipleTitle: document.getElementById('instructionPrincipleTitle'),
                    instructionPrincipleText: document.getElementById('instructionPrincipleText'),
                    instructionDurationTitle: document.getElementById('instructionDurationTitle'),
                    instructionDurationText: document.getElementById('instructionDurationText'),
                    instructionConfidentialTitle: document.getElementById('instructionConfidentialTitle'),
                    instructionConfidentialText: document.getElementById('instructionConfidentialText'),
                    instructionAutoSendTitle: document.getElementById('instructionAutoSendTitle'),
                    instructionAutoSendText: document.getElementById('instructionAutoSendText'),

                    // Rating Scale
                    ratingScaleTitle: document.getElementById('ratingScaleTitle'),
                    rating5Label: document.getElementById('rating5Label'),
                    rating4Label: document.getElementById('rating4Label'),
                    rating3Label: document.getElementById('rating3Label'),
                    rating2Label: document.getElementById('rating2Label'),
                    rating1Label: document.getElementById('rating1Label'),

                    // Calculator
                    calculatorTitle: document.getElementById('calculatorTitle'),
                    calculatorFormula: document.getElementById('calculatorFormula'),
                    formulaTitle: document.getElementById('formulaTitle'),
                    formulaText: document.getElementById('formulaText'),
                    exampleTitle: document.getElementById('exampleTitle'),
                    exampleText: document.getElementById('exampleText'),
                    noteTitle: document.getElementById('noteTitle'),
                    noteText: document.getElementById('noteText'),
                    explanationTitle: document.getElementById('explanationTitle'),
                    explanationText: document.getElementById('explanationText'),
                    totalPointsTitle: document.getElementById('totalPointsTitle'),
                    totalPointsText: document.getElementById('totalPointsText'),

                    // Settings
                    settingsTitle: document.getElementById('settingsTitle'),
                    departmentLabel: document.getElementById('departmentLabel'),
                    employeeLabel: document.getElementById('employeeLabel'),
                    supervisorLabel: document.getElementById('supervisorLabel'),
                    dateLabel: document.getElementById('dateLabel'),
                    generateButtonText: document.getElementById('generateButtonText'),

                    // Notes
                    notesTitle: document.getElementById('notesTitle'),
                    notesText: document.getElementById('notesText'),
                    generalNotesLabel: document.getElementById('generalNotesLabel'),
                    departmentNotesLabel: document.getElementById('departmentNotesLabel'),
                    overallNotesLabel: document.getElementById('overallNotesLabel'),
                    generalNotes: document.getElementById('generalNotes'),
                    departmentNotes: document.getElementById('departmentNotes'),
                    overallNotes: document.getElementById('overallNotes'),

                    // Print Notes
                    printNotesTitle: document.getElementById('printNotesTitle'),
                    printGeneralNotesLabel: document.getElementById('printGeneralNotesLabel'),
                    printDepartmentNotesLabel: document.getElementById('printDepartmentNotesLabel'),
                    printOverallNotesLabel: document.getElementById('printOverallNotesLabel'),
                    printGeneralNotesContent: document.getElementById('printGeneralNotesContent'),
                    printDepartmentNotesContent: document.getElementById('printDepartmentNotesContent'),
                    printOverallNotesContent: document.getElementById('printOverallNotesContent'),
                    printNotesSummary: document.getElementById('printNotesSummary'),

                    // Sections
                    generalCriteriaTitle: document.getElementById('generalCriteriaTitle'),
                    departmentCriteriaTitle: document.getElementById('departmentCriteriaTitle'),
                    selectPromptTitle: document.getElementById('selectPromptTitle'),
                    selectPromptText: document.getElementById('selectPromptText'),

                    // Summary
                    summaryTitle: document.getElementById('summaryTitle'),
                    summaryGeneralLabel: document.getElementById('summaryGeneralLabel'),
                    summaryDepartmentLabel: document.getElementById('summaryDepartmentLabel'),
                    summaryPercentageLabel: document.getElementById('summaryPercentageLabel'),
                    summaryGradeLabel: document.getElementById('summaryGradeLabel'),

                    // Total Score
                    totalScoreLabel: document.getElementById('totalScoreLabel'),

                    // Print
                    printReportTitle: document.getElementById('printReportTitle'),
                    printInfoTitle: document.getElementById('printInfoTitle'),
                    printEmployeeLabel: document.getElementById('printEmployeeLabel'),
                    printDepartmentLabel: document.getElementById('printDepartmentLabel'),
                    printSupervisorLabel: document.getElementById('printSupervisorLabel'),
                    printDateLabel: document.getElementById('printDateLabel'),
                    printTotalScoreLabel: document.getElementById('printTotalScoreLabel'),
                    printGradeLabel: document.getElementById('printGradeLabel'),

                    // Signatures
                    signaturesTitle: document.getElementById('signaturesTitle'),
                    employeeSignatureTitle: document.getElementById('employeeSignatureTitle'),
                    supervisorSignatureTitle: document.getElementById('supervisorSignatureTitle'),
                    hrSignatureTitle: document.getElementById('hrSignatureTitle'),

                    // Footer
                    copyrightText: document.getElementById('copyrightText'),
                    privacyLink: document.getElementById('privacyLink'),
                    termsLink: document.getElementById('termsLink'),
                    contactLink: document.getElementById('contactLink'),
                    supportLink: document.getElementById('supportLink'),

                    // Form elements
                    departmentSelect: document.getElementById('departmentSelect'),
                    employeeSelect: document.getElementById('employeeSelect'),
                    supervisorSelect: document.getElementById('supervisorSelect'),
                    evaluationDate: document.getElementById('evaluationDate'),
                    generateBtn: document.getElementById('generateAndSend'),
                    notification: document.getElementById('notification'),
                    notificationTitle: document.getElementById('notificationTitle'),
                    notificationMessage: document.getElementById('notificationMessage'),
                    notificationClose: document.querySelector('.notification-close'),
                    generalCriteriaBody: document.getElementById('generalCriteriaBody'),
                    departmentCriteria: document.getElementById('departmentCriteria'),
                    generalScore: document.getElementById('generalScore'),
                    departmentScore: document.getElementById('departmentScore'),
                    summaryCard: document.getElementById('summaryCard'),
                    summaryGeneral: document.getElementById('summaryGeneral'),
                    summaryDepartment: document.getElementById('summaryDepartment'),
                    summaryPercentage: document.getElementById('summaryPercentage'),
                    summaryGrade: document.getElementById('summaryGrade'),
                    summaryMessage: document.getElementById('summaryMessage'),
                    finalScore: document.getElementById('finalScore'),
                    scoreGrade: document.getElementById('scoreGrade'),
                    performanceTips: document.getElementById('performanceTips'),
                    scoreProgress: document.getElementById('scoreProgress'),
                    totalScoreDisplay: document.getElementById('totalScoreDisplay'),
                    printReportHeader: document.getElementById('printReportHeader'),
                    printEmployeeInfo: document.getElementById('printEmployeeInfo'),
                    printDepartmentInfo: document.getElementById('printDepartmentInfo'),
                    printSupervisorInfo: document.getElementById('printSupervisorInfo'),
                    printDateInfo: document.getElementById('printDateInfo'),
                    printTotalScore: document.getElementById('printTotalScore'),
                    printGradeInfo: document.getElementById('printGradeInfo'),
                    printSignatures: document.getElementById('printSignatures'),
                    printEmployeeSignature: document.getElementById('printEmployeeSignature'),
                    printSupervisorSignature: document.getElementById('printSupervisorSignature'),
                    printSignatureDate1: document.getElementById('printSignatureDate1'),
                    printSignatureDate2: document.getElementById('printSignatureDate2'),
                    printSignatureDate3: document.getElementById('printSignatureDate3')
                };
            }

            init() {
                // تهيئة مدير الشعار
                this.logoManager = new LogoManager();

                // تعيين التاريخ الحالي
                const today = new Date().toISOString().split('T')[0];
                this.elements.evaluationDate.value = today;
                this.state.evaluationDate = today;

                // تعبئة المشرفين
                this.populateSupervisors();

                // عرض المعايير العامة
                this.renderGeneralCriteria();

                // إضافة مستمعي الأحداث
                this.bindEvents();

                // تهيئة العرض التقديمي
                setTimeout(() => {
                    this.elements.departmentSelect.value = 'sales';
                    this.onDepartmentChange();
                }, 500);
            }

            bindEvents() {
                this.elements.departmentSelect.addEventListener('change', () => this.onDepartmentChange());
                this.elements.employeeSelect.addEventListener('change', () => this.onEmployeeChange());
                this.elements.supervisorSelect.addEventListener('change', () => {
                    this.state.currentSupervisor = this.elements.supervisorSelect.value;
                });
                this.elements.evaluationDate.addEventListener('change', () => {
                    this.state.evaluationDate = this.elements.evaluationDate.value;
                });
                this.elements.generateBtn.addEventListener('click', () => this.generateAndSendReport());
                this.elements.notificationClose.addEventListener('click', () => this.hideNotification());
                this.elements.langSwitch.addEventListener('click', () => this.switchLanguage());

                // إضافة مستمعي الأحداث للملاحظات
                this.elements.generalNotes.addEventListener('input', (e) => {
                    this.state.notes.general = e.target.value;
                });
                this.elements.departmentNotes.addEventListener('input', (e) => {
                    this.state.notes.department = e.target.value;
                });
                this.elements.overallNotes.addEventListener('input', (e) => {
                    this.state.notes.overall = e.target.value;
                });

                // إضافة مستمع لحدث الطباعة
                window.addEventListener('beforeprint', () => this.prepareForPrint());
            }

            switchLanguage() {
                this.state.currentLanguage = this.state.currentLanguage === 'ar' ? 'en' : 'ar';
                this.applyLanguage();
            }

            applyLanguage() {
                const lang = this.state.currentLanguage;
                const t = TRANSLATIONS[lang];

                // تحديث جميع النصوص
                Object.keys(t).forEach(key => {
                    if (this.elements[key]) {
                        if (typeof t[key] === 'string') {
                            this.elements[key].textContent = t[key];
                        }
                    }
                });

                // تحديث زر تبديل اللغة
                this.elements.langText.textContent = t.langText;

                // تحديث اتجاه الصفحة
                document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
                document.documentElement.lang = lang;

                // تحديث عناصر النصوص الديناميكية
                this.updatePlaceholders();

                // إعادة تعبئة الأقسام والموظفين والمشرفين
                this.populateDepartments();
                this.populateEmployees();
                this.populateSupervisors();

                // إعادة عرض المعايير
                this.renderGeneralCriteria();
                this.renderDepartmentCriteria();

                // تحديث الملخص
                this.updateScores();
            }

            updatePlaceholders() {
                const lang = this.state.currentLanguage;
                const placeholders = {
                    generalNotes: lang === 'ar' ? 'اكتب ملاحظاتك حول المعايير العامة هنا...' : 'Write your notes about general criteria here...',
                    departmentNotes: lang === 'ar' ? 'اكتب ملاحظاتك حول معايير القسم هنا...' : 'Write your notes about department criteria here...',
                    overallNotes: lang === 'ar' ? 'اكتب الملاحظات العامة والتوصيات هنا...' : 'Write general notes and recommendations here...'
                };

                this.elements.generalNotes.placeholder = placeholders.generalNotes;
                this.elements.departmentNotes.placeholder = placeholders.departmentNotes;
                this.elements.overallNotes.placeholder = placeholders.overallNotes;
            }

            populateDepartments() {
                const lang = this.state.currentLanguage;
                const options = this.elements.departmentSelect.querySelectorAll('option');

                options.forEach((option, index) => {
                    if (index > 0) { // تخطي الخيار الأول
                        const value = option.value;
                        const span = option.querySelector('span');
                        if (span) {
                            const className = span.className.replace('lang-', '');
                            if (className in TRANSLATIONS[lang]) {
                                span.textContent = TRANSLATIONS[lang][className];
                            }
                        }
                    }
                });
            }

            onDepartmentChange() {
                this.state.currentDepartment = this.elements.departmentSelect.value;
                this.populateEmployees();
                this.renderDepartmentCriteria();
            }

            onEmployeeChange() {
                this.state.currentEmployee = this.elements.employeeSelect.value;
                this.renderDepartmentCriteria();
            }

            populateSupervisors() {
                const lang = this.state.currentLanguage;
                this.elements.supervisorSelect.innerHTML = '<option value="">-- ' + TRANSLATIONS[lang].supervisor + ' --</option>';

                Object.values(ORGANIZATION_DATA.supervisors).forEach(departmentSupervisors => {
                    departmentSupervisors.forEach(supervisor => {
                        const option = document.createElement('option');
                        option.value = supervisor.id;
                        option.textContent = `${supervisor.name} - ${supervisor.position[lang]}`;
                        this.elements.supervisorSelect.appendChild(option);
                    });
                });
            }

            populateEmployees() {
                const deptId = this.state.currentDepartment;
                const dept = ORGANIZATION_DATA.departments[deptId];
                const lang = this.state.currentLanguage;

                this.elements.employeeSelect.innerHTML = '<option value="">-- ' + TRANSLATIONS[lang].employee + ' --</option>';

                if (!dept) return;

                let allEmployees = [];

                // إضافة الموظفين المباشرين
                if (dept.employees) {
                    allEmployees = allEmployees.concat(dept.employees);
                }

                // إضافة موظفي الفرق
                if (dept.teams) {
                    Object.values(dept.teams).forEach(team => {
                        allEmployees = allEmployees.concat(team.employees);
                    });
                }

                // تعبئة القائمة
                allEmployees.forEach(employee => {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = `${employee.name} - ${employee.position[lang]}`;
                    this.elements.employeeSelect.appendChild(option);
                });
            }

            renderGeneralCriteria() {
                const container = this.elements.generalCriteriaBody;
                const lang = this.state.currentLanguage;
                container.innerHTML = '';

                ORGANIZATION_DATA.general.forEach(criterion => {
                    const rating = this.state.ratings.general.get(criterion.id) || 0;
                    const calculated = rating > 0 ? (rating / 5) * criterion.weight : 0;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="criteria-name">${criterion.name[lang]}</div>
                            <div class="criteria-description">${criterion.description[lang]}</div>
                        </td>
                        <td>${criterion.description[lang]}</td>
                        <td style="text-align: center;"><span class="weight-badge">${criterion.weight}</span></td>
                        <td>
                            <div class="rating-controls" data-criterion-id="${criterion.id}" data-criterion-type="general">
                                ${[1,2,3,4,5].map(num => `
                                    <div class="rating-btn ${rating === num ? 'selected' : ''}"
                                         data-value="${num}">${num}</div>
                                `).join('')}
                                <span class="printed-rating" style="display: none;">${rating > 0 ? rating : '-'}</span>
                            </div>
                        </td>
                        <td style="text-align: center;">
                            <span class="calculated-value">${calculated > 0 ? calculated.toFixed(1) : '0.0'}</span>
                        </td>
                    `;
                    container.appendChild(row);
                });

                this.bindRatingEvents();
            }

            renderDepartmentCriteria() {
                const deptId = this.state.currentDepartment;
                const dept = ORGANIZATION_DATA.departments[deptId];
                const lang = this.state.currentLanguage;

                if (!deptId || !dept) {
                    this.elements.departmentCriteria.innerHTML = `
                        <div style="padding: 40px; text-align: center; color: var(--gray-color);">
                            <i class="fas fa-hand-pointer" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <h3 style="margin-bottom: 10px;">${TRANSLATIONS[lang].selectPromptTitle}</h3>
                            <p>${TRANSLATIONS[lang].selectPromptText}</p>
                        </div>
                    `;
                    this.hideSummary();
                    return;
                }

                const criteria = this.getDepartmentCriteria(deptId, this.state.currentEmployee, lang);

                let tableHTML = `
                    <table class="criteria-table">
                        <thead>
                            <tr>
                                <th width="30%">${TRANSLATIONS[lang].criteria}</th>
                                <th width="35%">${TRANSLATIONS[lang].description}</th>
                                <th width="10%">${TRANSLATIONS[lang].weight}</th>
                                <th width="15%">${TRANSLATIONS[lang].rating}</th>
                                <th width="10%">${TRANSLATIONS[lang].value}</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                if (criteria.length === 0) {
                    tableHTML += `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: var(--gray-color);">
                                <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 15px;"></i>
                                <h3>${lang === 'ar' ? 'لا توجد معايير مخصصة لهذا الموظف' : 'No specific criteria for this employee'}</h3>
                                <p>${lang === 'ar' ? 'يرجى التواصل مع إدارة الموارد البشرية0561101262' : 'Please contact Human Resources Department'}</p>
                            </td>
                        </tr>
                    `;
                } else {
                    criteria.forEach(criterion => {
                        const rating = this.state.ratings.department.get(criterion.id) || 0;
                        const calculated = rating > 0 ? (rating / 5) * criterion.weight : 0;

                        tableHTML += `
                            <tr>
                                <td>
                                    <div class="criteria-name">${criterion.name[lang]}</div>
                                    ${criterion.description ? `<div class="criteria-description">${criterion.description[lang]}</div>` : ''}
                                </td>
                                <td>${criterion.description ? criterion.description[lang] : ''}</td>
                                <td style="text-align: center;"><span class="weight-badge">${criterion.weight}</span></td>
                                <td>
                                    <div class="rating-controls" data-criterion-id="${criterion.id}" data-criterion-type="department">
                                        ${[1,2,3,4,5].map(num => `
                                            <div class="rating-btn ${rating === num ? 'selected' : ''}"
                                                 data-value="${num}">${num}</div>
                                        `).join('')}
                                        <span class="printed-rating" style="display: none;">${rating > 0 ? rating : '-'}</span>
                                    </div>
                                </td>
                                <td style="text-align: center;">
                                    <span class="calculated-value">${calculated > 0 ? calculated.toFixed(1) : '0.0'}</span>
                                </td>
                            </tr>
                        `;
                    });
                }

                tableHTML += `</tbody></table>`;
                this.elements.departmentCriteria.innerHTML = tableHTML;

                this.bindRatingEvents();
                this.updateScores();
            }

            getDepartmentCriteria(deptId, employeeId, lang = 'ar') {
                const dept = ORGANIZATION_DATA.departments[deptId];
                if (!dept) return [];

                const employeeOption = this.elements.employeeSelect.querySelector(`option[value="${employeeId}"]`);
                const employeeText = employeeOption ? employeeOption.textContent : '';

                if (deptId === 'sales') {
                    if (employeeText.includes('مندوب مبيعات') || employeeText.includes('Sales Representative')) {
                        return dept.criteria.sales_rep || [];
                    } else if (employeeText.includes('موظف تسليم') || employeeText.includes('Delivery Staff')) {
                        return dept.criteria.delivery_staff || [];
                    } else if (employeeText.includes('عامل تسليم') || employeeText.includes('Delivery Worker')) {
                        return dept.criteria.delivery_workers || [];
                    }
                } else if (deptId === 'vehicles') {
                    if (employeeText.includes('رافعة شوكية') || employeeText.includes('Forklift Driver')) {
                        return dept.criteria.forklift_drivers || [];
                    } else if (employeeText.includes('سائق شحن') || employeeText.includes('Shipping Driver')) {
                        return dept.criteria.shipping_drivers || [];
                    }
                } else if (deptId === 'marketing') {
                    if (employeeText.includes('مصور') || employeeText.includes('Photographer')) {
                        return dept.teams.photographer.criteria || [];
                    } else if (employeeText.includes('مونتاج') || employeeText.includes('Video Editor')) {
                        return dept.teams.editor.criteria || [];
                    } else if (employeeText.includes('مصمم إعلان') || employeeText.includes('Ad Designer')) {
                        return dept.teams.designer.criteria || [];
                    } else if (employeeText.includes('سوشيال ميديا') || employeeText.includes('Social Media')) {
                        return dept.teams.social_media.criteria || [];
                    }
                } else if (deptId === 'projects') {
                    if (employeeText.includes('فورمان') || employeeText.includes('Foreman')) {
                        return dept.criteria.foremen || [];
                    } else if (employeeText.includes('عامل مشروع') || employeeText.includes('Project Worker')) {
                        return dept.criteria.project_workers || [];
                    }
                } else if (deptId === 'marble') {
                    if (employeeText.includes('عامل مشروع') || employeeText.includes('Project Worker')) {
                        return dept.criteria.project_workers || [];
                    } else if (employeeText.includes('عامل قص') || employeeText.includes('Cutter')) {
                        return dept.criteria.cutting_workers || [];
                    } else if (employeeText.includes('عامل تركيب') || employeeText.includes('Installer')) {
                        return dept.criteria.installation_workers || [];
                    } else if (employeeText.includes('عامل تشطيب') || employeeText.includes('Finisher')) {
                        return dept.criteria.finishing_workers || [];
                    }
                } else if (Array.isArray(dept.criteria)) {
                    return dept.criteria;
                }

                return [];
            }

            bindRatingEvents() {
                document.querySelectorAll('.rating-controls').forEach(container => {
                    container.querySelectorAll('.rating-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const value = parseInt(e.target.dataset.value);
                            const criterionId = container.dataset.criterionId;
                            const type = container.dataset.criterionType;

                            this.state.ratings[type].set(criterionId, value);

                            container.querySelectorAll('.rating-btn').forEach(b => {
                                b.classList.remove('selected');
                            });
                            e.target.classList.add('selected');

                            const row = e.target.closest('tr');
                            const calculatedCell = row.querySelector('.calculated-value');
                            const printedRating = container.querySelector('.printed-rating');
                            if (printedRating) {
                                printedRating.textContent = value;
                            }

                            if (calculatedCell) {
                                const criterion = this.getCriterionById(type, criterionId);
                                if (criterion) {
                                    const calculated = (value / 5) * criterion.weight;
                                    calculatedCell.textContent = calculated.toFixed(1);
                                }
                            }

                            this.updateScores();
                        });
                    });
                });
            }

            getCriterionById(type, criterionId) {
                if (type === 'general') {
                    return ORGANIZATION_DATA.general.find(c => c.id === criterionId);
                } else {
                    const deptId = this.state.currentDepartment;
                    const criteria = this.getDepartmentCriteria(deptId, this.state.currentEmployee);
                    return criteria.find(c => c.id === criterionId);
                }
            }

            calculateScore(type, criteria) {
                let total = 0;
                criteria.forEach(criterion => {
                    const rating = this.state.ratings[type].get(criterion.id) || 0;
                    if (rating > 0) {
                        total += (rating / 5) * criterion.weight;
                    }
                });
                return Math.round(total * 100) / 100;
            }

            getGrade(percentage) {
                const lang = this.state.currentLanguage;

                if (percentage >= 90) {
                    return {
                        name: lang === 'ar' ? 'ممتاز' : 'Excellent',
                        message: lang === 'ar' ? 'أداء متميز' : 'Outstanding Performance',
                        color: '#27ae60'
                    };
                } else if (percentage >= 80) {
                    return {
                        name: lang === 'ar' ? 'جيد جداً' : 'Very Good',
                        message: lang === 'ar' ? 'أداء عالي' : 'High Performance',
                        color: '#2ecc71'
                    };
                } else if (percentage >= 70) {
                    return {
                        name: lang === 'ar' ? 'جيد' : 'Good',
                        message: lang === 'ar' ? 'أداء جيد' : 'Good Performance',
                        color: '#f39c12'
                    };
                } else if (percentage >= 60) {
                    return {
                        name: lang === 'ar' ? 'مقبول' : 'Acceptable',
                        message: lang === 'ar' ? 'أداء مقبول' : 'Acceptable Performance',
                        color: '#e67e22'
                    };
                } else {
                    return {
                        name: lang === 'ar' ? 'ضعيف' : 'Weak',
                        message: lang === 'ar' ? 'يحتاج للتحسين' : 'Needs Improvement',
                        color: '#e74c3c'
                    };
                }
            }

            updateScores() {
                const generalScore = this.calculateScore('general', ORGANIZATION_DATA.general);
                const deptId = this.state.currentDepartment;
                const departmentCriteria = this.getDepartmentCriteria(deptId, this.state.currentEmployee);
                const departmentScore = this.calculateScore('department', departmentCriteria);

                this.elements.generalScore.textContent = generalScore.toFixed(2);
                this.elements.departmentScore.textContent = departmentScore.toFixed(2);

                const totalScore = generalScore + departmentScore;
                const percentage = Math.round((totalScore / 100) * 100);
                const grade = this.getGrade(percentage);

                this.elements.summaryGeneral.textContent = `${generalScore.toFixed(2)}/15`;
                this.elements.summaryDepartment.textContent = `${departmentScore.toFixed(2)}/85`;
                this.elements.summaryPercentage.textContent = `${percentage}%`;
                this.elements.summaryGrade.textContent = grade.name;
                this.elements.summaryMessage.textContent = grade.message;

                this.elements.finalScore.textContent = totalScore.toFixed(2);
                this.elements.scoreGrade.textContent = `${grade.name} - ${grade.message}`;
                this.elements.performanceTips.textContent = grade.message;
                this.elements.scoreProgress.style.width = `${percentage}%`;
                this.elements.scoreProgress.style.background = grade.color;

                if (deptId) {
                    this.elements.summaryCard.style.display = 'block';
                    this.elements.totalScoreDisplay.style.display = 'block';
                }
            }

            hideSummary() {
                this.elements.summaryCard.style.display = 'none';
                this.elements.totalScoreDisplay.style.display = 'none';
            }

            validateForm() {
                const lang = this.state.currentLanguage;

                if (!this.state.currentDepartment) {
                    this.showNotification('error',
                        lang === 'ar' ? 'خطأ' : 'Error',
                        lang === 'ar' ? 'يرجى اختيار القسم' : 'Please select a department');
                    this.elements.departmentSelect.focus();
                    return false;
                }

                if (!this.state.currentEmployee) {
                    this.showNotification('error',
                        lang === 'ar' ? 'خطأ' : 'Error',
                        lang === 'ar' ? 'يرجى اختيار الموظف' : 'Please select an employee');
                    this.elements.employeeSelect.focus();
                    return false;
                }

                if (!this.state.currentSupervisor) {
                    this.showNotification('error',
                        lang === 'ar' ? 'خطأ' : 'Error',
                        lang === 'ar' ? 'يرجى اختيار المشرف' : 'Please select a supervisor');
                    this.elements.supervisorSelect.focus();
                    return false;
                }

                return true;
            }

            async generateAndSendReport() {
                try {
                    if (!this.validateForm()) return;

                    const lang = this.state.currentLanguage;
                    this.showNotification('info',
                        lang === 'ar' ? 'جارٍ المعالجة' : 'Processing',
                        lang === 'ar' ? 'جاري إعداد التقرير وإرساله...' : 'Preparing and sending report...');

                    // جمع بيانات التقرير
                    const reportData = this.collectReportData();

                    // إرسال إلى Telegram
                    await this.sendToTelegram(reportData);

                    // تحضير للطباعة
                    this.prepareForPrint();

                    // الطباعة
                    window.print();

                    this.showNotification('success',
                        lang === 'ar' ? 'تمت العملية' : 'Operation Completed',
                        lang === 'ar' ? 'تم إرسال التقرير إلى قناة الموارد البشرية وتم تحضيره للطباعة' :
                                      'Report sent to HR channel and prepared for printing');

                } catch (error) {
                    console.error('Error:', error);
                    const lang = this.state.currentLanguage;
                    this.showNotification('error',
                        lang === 'ar' ? 'خطأ' : 'Error',
                        lang === 'ar' ? 'حدث خطأ أثناء العملية' : 'An error occurred during the operation');
                }
            }

            prepareForPrint() {
                const lang = this.state.currentLanguage;

                // تعيين معلومات التقرير للطباعة
                const employeeOption = this.elements.employeeSelect.options[this.elements.employeeSelect.selectedIndex];
                const supervisorOption = this.elements.supervisorSelect.options[this.elements.supervisorSelect.selectedIndex];
                const deptId = this.state.currentDepartment;
                const dept = ORGANIZATION_DATA.departments[deptId];

                if (employeeOption) {
                    this.elements.printEmployeeInfo.textContent = employeeOption.textContent;
                    this.elements.printEmployeeSignature.textContent = employeeOption.textContent.split('-')[0].trim();
                }

                if (dept) {
                    this.elements.printDepartmentInfo.textContent = dept.name[lang];
                }

                if (supervisorOption) {
                    this.elements.printSupervisorInfo.textContent = supervisorOption.textContent;
                    this.elements.printSupervisorSignature.textContent = supervisorOption.textContent.split('-')[0].trim();
                }

                // تعيين التاريخ
                const today = new Date();
                const formattedDate = today.toLocaleDateString(lang === 'ar' ? 'ar-SA' : 'en-US', {
                    year: 'numeric',
                    month: 'short',  // استخدام الشهر المختصر
                    day: 'numeric'
                });
                this.elements.printDateInfo.textContent = formattedDate;
                this.elements.printSignatureDate1.textContent = formattedDate;
                this.elements.printSignatureDate2.textContent = formattedDate;
                this.elements.printSignatureDate3.textContent = formattedDate;

                // تعيين النتائج
                const generalScore = parseFloat(this.elements.generalScore.textContent);
                const departmentScore = parseFloat(this.elements.departmentScore.textContent);
                const totalScore = generalScore + departmentScore;
                const percentage = Math.round((totalScore / 100) * 100);
                const grade = this.getGrade(percentage);

                this.elements.printTotalScore.textContent = `${totalScore.toFixed(1)}/100`;
                this.elements.printGradeInfo.textContent = `${grade.name} - ${grade.message}`;

                // تعيين الملاحظات للطباعة (مختصرة)
                const truncateText = (text, maxLength = 150) => {
                    if (!text) return lang === 'ar' ? 'لا توجد ملاحظات' : 'No notes';
                    if (text.length > maxLength) {
                        return text.substring(0, maxLength) + '...';
                    }
                    return text;
                };

                this.elements.printGeneralNotesContent.textContent = truncateText(this.state.notes.general);
                this.elements.printDepartmentNotesContent.textContent = truncateText(this.state.notes.department);
                this.elements.printOverallNotesContent.textContent = truncateText(this.state.notes.overall);

                // إظهار عناصر الطباعة
                this.elements.printReportHeader.style.display = 'block';
                this.elements.printSignatures.style.display = 'block';
                this.elements.printNotesSummary.style.display = 'block';

                // تحديث التقييمات المطبوعة
                this.updatePrintedRatings();

                // تقليل عدد الصفوف المعروضة في الجداول إذا كانت كثيرة
                this.compressTablesForPrint();
            }

            // دالة جديدة لضغط الجداول للطباعة
            compressTablesForPrint() {
                // تقليل المسافات في الجداول
                const tables = document.querySelectorAll('.criteria-table');
                tables.forEach(table => {
                    // إخفاء الوصف في الطباعة
                    const descriptionCells = table.querySelectorAll('td:nth-child(2), th:nth-child(2)');
                    descriptionCells.forEach(cell => {
                        cell.style.display = 'none';
                    });

                    // تقليل ارتفاع الصفوف
                    const rows = table.querySelectorAll('tr');
                    rows.forEach(row => {
                        row.style.height = '20px';
                        row.style.minHeight = '20px';
                        row.style.maxHeight = '20px';
                    });
                });
            }

            updatePrintedRatings() {
                // تحديث التقييمات في جدول المعايير العامة
                document.querySelectorAll('#generalCriteriaBody .rating-controls').forEach(container => {
                    const printedRating = container.querySelector('.printed-rating');
                    if (printedRating) {
                        const criterionId = container.dataset.criterionId;
                        const rating = this.state.ratings.general.get(criterionId) || 0;
                        printedRating.textContent = rating > 0 ? rating : '-';
                    }
                });

                // تحديث التقييمات في جدول معايير القسم
                document.querySelectorAll('#departmentCriteria .rating-controls').forEach(container => {
                    const printedRating = container.querySelector('.printed-rating');
                    if (printedRating) {
                        const criterionId = container.dataset.criterionId;
                        const rating = this.state.ratings.department.get(criterionId) || 0;
                        printedRating.textContent = rating > 0 ? rating : '-';
                    }
                });
            }

            collectReportData() {
                const lang = this.state.currentLanguage;

                // جمع المعلومات الأساسية
                const employeeOption = this.elements.employeeSelect.options[this.elements.employeeSelect.selectedIndex];
                const supervisorOption = this.elements.supervisorSelect.options[this.elements.supervisorSelect.selectedIndex];
                const deptId = this.state.currentDepartment;
                const dept = ORGANIZATION_DATA.departments[deptId];

                // حساب النتائج
                const generalScore = parseFloat(this.elements.generalScore.textContent);
                const departmentScore = parseFloat(this.elements.departmentScore.textContent);
                const totalScore = generalScore + departmentScore;
                const percentage = Math.round((totalScore / 100) * 100);
                const grade = this.getGrade(percentage);

                return {
                    employee: employeeOption ? employeeOption.textContent : '',
                    department: dept ? dept.name[lang] : '',
                    supervisor: supervisorOption ? supervisorOption.textContent : '',
                    date: this.state.evaluationDate,
                    generalScore: generalScore,
                    departmentScore: departmentScore,
                    totalScore: totalScore,
                    percentage: percentage,
                    grade: grade.name,
                    gradeMessage: grade.message,
                    notes: {
                        general: this.state.notes.general,
                        department: this.state.notes.department,
                        overall: this.state.notes.overall
                    }
                };
            }

            async sendToTelegram(reportData) {
                const lang = this.state.currentLanguage;

                // بناء الرسالة
                const message = `
📊 *${lang === 'ar' ? 'تقرير التقييم الموحد' : 'Unified Evaluation Report'}*
----------------------------
👤 *${lang === 'ar' ? 'الموظف:' : 'Employee:'}* ${reportData.employee}
🏢 *${lang === 'ar' ? 'القسم:' : 'Department:'}* ${reportData.department}
👨‍💼 *${lang === 'ar' ? 'المشرف:' : 'Supervisor:'}* ${reportData.supervisor}
📅 *${lang === 'ar' ? 'تاريخ التقييم:' : 'Evaluation Date:'}* ${reportData.date}
----------------------------
📈 *${lang === 'ar' ? 'النتائج:' : 'Results:'}*
• ${lang === 'ar' ? 'المعايير العامة:' : 'General Criteria:'} ${reportData.generalScore}/15
• ${lang === 'ar' ? 'معايير القسم:' : 'Department Criteria:'} ${reportData.departmentScore}/85
• ${lang === 'ar' ? 'الإجمالي:' : 'Total:'} ${reportData.totalScore.toFixed(2)}/100
• ${lang === 'ar' ? 'النسبة:' : 'Percentage:'} ${reportData.percentage}%
• ${lang === 'ar' ? 'التقدير:' : 'Grade:'} ${reportData.grade} - ${reportData.gradeMessage}
----------------------------
📝 *${lang === 'ar' ? 'الملاحظات:' : 'Notes:'}*
*${lang === 'ar' ? 'ملاحظات المعايير العامة:' : 'General Criteria Notes:'}*
${reportData.notes.general || (lang === 'ar' ? 'لا توجد ملاحظات' : 'No notes')}

*${lang === 'ar' ? 'ملاحظات معايير القسم:' : 'Department Criteria Notes:'}*
${reportData.notes.department || (lang === 'ar' ? 'لا توجد ملاحظات' : 'No notes')}

*${lang === 'ar' ? 'ملاحظات عامة وتوصيات:' : 'Overall Notes and Recommendations:'}*
${reportData.notes.overall || (lang === 'ar' ? 'لا توجد ملاحظات' : 'No notes')}
----------------------------
${lang === 'ar' ? 'تم إرسال هذا التقرير تلقائياً من النظام الموحد للتقييم' : 'This report was automatically sent from the Unified Evaluation System'}
                `;

                const url = `https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/sendMessage`;

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            chat_id: CONFIG.HR_CHANNEL,
                            text: message,
                            parse_mode: 'Markdown'
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }

                    const data = await response.json();
                    console.log('Message sent successfully:', data);
                } catch (error) {
                    console.error('Error sending message to Telegram:', error);
                    throw error;
                }
            }

            showNotification(type, title, message) {
                const notification = this.elements.notification;
                const titleElem = this.elements.notificationTitle;
                const messageElem = this.elements.notificationMessage;

                // إزالة جميع الأصناف
                notification.classList.remove('success', 'error', 'info');

                // إضافة الصنف الجديد
                notification.classList.add(type);

                // تعيين النصوص
                titleElem.textContent = title;
                messageElem.textContent = message;

                // تغيير الأيقونة بناءً على النوع
                const icon = notification.querySelector('.notification-icon i');
                if (type === 'success') {
                    icon.className = 'fas fa-check-circle';
                } else if (type === 'error') {
                    icon.className = 'fas fa-exclamation-circle';
                } else if (type === 'info') {
                    icon.className = 'fas fa-info-circle';
                }

                // إظهار الإشعار
                notification.classList.add('show');

                // إخفاء تلقائي بعد 5 ثواني
                setTimeout(() => {
                    this.hideNotification();
                }, 5000);
            }

            hideNotification() {
                this.elements.notification.classList.remove('show');
            }

            // ========== دالة لتحميل الشعار من ملف محلي ==========
            loadLogoFromFile(filePath) {
                // هذه دالة مساعدة لتحميل الشعار من ملف في نفس المجلد
                fetch(filePath)
                    .then(response => response.blob())
                    .then(blob => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.logoManager.setLogoFromBase64(e.target.result);
                        };
                        reader.readAsDataURL(blob);
                    })
                    .catch(error => {
                        console.error('فشل تحميل الشعار:', error);
                        this.logoManager.useDefaultLogo();
                    });
            }

            // ========== دالة لاستخدام شعار افتراضي ==========
            useDefaultLogo() {
                this.logoManager.useDefaultLogo();
            }

            // ========== دالة للحصول على الشعار الحالي ==========
            getCurrentLogo() {
                return this.logoManager.getLogoAsBase64();
            }
        }

        // ========== تهيئة التطبيق عند تحميل الصفحة ==========
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new EvaluationApp();

            // دالة لتحميل الشعار من ملف في نفس المجلد (اختياري)
            // window.app.loadLogoFromFile('logo.png');

            // أو استخدام شعار افتراضي من Base64
            // const customLogo = 'data:image/png;base64,....';
            // window.app.logoManager.setLogoFromBase64(customLogo);
        });

        // ========== دوال مساعدة للشعار ==========
        function setCompanyLogo(base64String) {
            if (window.app && window.app.logoManager) {
                window.app.logoManager.setLogoFromBase64(base64String);
            }
        }

        function getCompanyLogo() {
            if (window.app && window.app.logoManager) {
                return window.app.logoManager.getLogoAsBase64();
            }
            return null;
        }

        function resetLogoToDefault() {
            if (window.app && window.app.logoManager) {
                window.app.logoManager.useDefaultLogo();
            }
        }
    </script>
</body>
</html>
